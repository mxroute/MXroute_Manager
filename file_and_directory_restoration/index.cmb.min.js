define("app/services/backupAPI",["angular","cjt/util/locale","cjt/io/uapi-request","cjt/services/APIService","cjt/io/uapi"],function(e,t,a){"use strict";var r;try{r=e.module("App")}catch(i){r=e.module("App",[])}r.factory("backupAPIService",["APIService",function(r){function i(e){var a=e.data,r=[];return a.forEach(function(e){if(e.lastModifiedTime=t.local_datetime(parseInt(e.mtime,10),"datetime_format_medium"),!n.hasOwnProperty(e.backupType))throw"DEVELOPER ERROR: Invalid backup type";e.backupType=n[e.backupType],r.push(e)}),r}var n={compressed:t.maketext("Compressed"),uncompressed:t.maketext("Uncompressed"),incremental:t.maketext("Incremental")},c=function(){};return c.prototype=new r,e.extend(c.prototype,{listDirectory:function(e,t,r){var i=new a.Class;i.initialize("Restore","directory_listing"),i.addArgument("path",e),r&&i.addPaging(t,r);var n=this.deferred(i,{transformAPISuccess:function(e){return e},transformAPIFailure:function(e){return e.error}});return n.promise},listBackups:function(e){var t=new a.Class;t.initialize("Restore","query_file_info"),t.addArgument("path",e);var r=this.deferred(t,{transformAPISuccess:i,transformAPIFailure:function(e){return e.error}});return r.promise},restore:function(e,t){var r=new a.Class;r.initialize("Restore","restore_file"),r.addArgument("backupID",t),r.addArgument("path",e),r.addArgument("overwrite",1);var i=this.deferred(r,{transformAPISuccess:function(e){return e.data},transformAPIFailure:function(e){return e.error}});return i.promise}}),new c}])}),define("app/filters/fileSizeFilter",["angular","cjt/util/locale"],function(e,t){"use strict";var a;try{a=e.module("App")}catch(r){a=e.module("App",[])}a.filter("convertedSize",function(){return function(e){return t.format_bytes(e)}})}),define("app/services/backupTypeService",["angular"],function(e){"use strict";var t;try{t=e.module("App")}catch(a){t=e.module("App",[])}t.factory("backupTypeService",function(){var e;return{getBackupType:function(){if(e)return e;throw"DEVELOPER ERROR: backup type is not defined"},setBackupType:function(t){if(!t||"string"!=typeof t)throw"DEVELOPER ERROR: backup type is not valid";return e=t}}})}),define("app/views/list",["angular","lodash","cjt/util/locale","cjt/services/cpanel/nvDataService","app/services/backupAPI","app/services/backupTypeService","uiBootstrap","cjt/services/alertService","cjt/directives/alert","cjt/directives/alertList"],function(e,t,a){"use strict";var r=e.module("App");r.controller("restoreModalController",["$scope","backupTypeService","$uibModalInstance","fileExists",function(e,t,a,r){e.fileExists=r,e.itemType=t.getBackupType(),e.closeModal=function(){a.close()},e.runIt=function(){a.close(!0)}}]);var i=r.controller("listController",["$scope","backupAPIService","backupTypeService","$uibModal","nvDataService","alertService",function(e,r,i,n,c,o){e.buildBreadcrumb=function(){e.directoryBreadcrumb=[];for(var t=e.currentPath.split("/"),a="/",r=0,i=t.length;i-1>r;r++)0===r?e.directoryBreadcrumb.push({folder:a,path:a,displayPath:t[r]}):(e.directoryBreadcrumb.push({folder:a,path:a+t[r]+"/",displayPath:t[r]}),a=a+t[r]+"/")},e.goHome=function(){"/"!==e.currentPath&&e.changeDirectory("/")},e.changeDirectory=function(t){e.loadingData=!0,e.backupList=[];var a;a=t?t:e.directoryBreadcrumb[e.directoryBreadcrumb.length-2].path,"/"!==a.charAt(a.length-1)&&(a+="/"),"/"!==a.charAt(0)&&(a="/"+a),e.meta.start=(e.meta.currentPage-1)*e.meta.pageSize+1,(a!==e.currentPath||e.meta.start>e.meta.totalItems)&&(e.meta.currentPage=1,e.meta.start=1);for(var i=0,n=e.currentDirectoryContent.length;n>i;i++)if(e.currentDirectoryContent[i].fullPath===t){e.selectedItemExists=e.currentDirectoryContent[i].exists;break}r.listDirectory(a,e.meta.currentPage,e.meta.pageSize).then(function(t){e.currentPath=a,e.buildBreadcrumb(),e.addPaths(t.data);var r=t.meta.paginate;e.updatePagination(r)},function(e){o.add({type:"danger",message:e,closeable:!0,group:"cpanel-restoration"})}).finally(function(){e.loadingData=!1})},e.changePageSize=function(){c.setObject({file_restoration_page_size:e.meta.pageSize}),e.changeDirectory(e.currentPath)},e.goToPage=function(t,a){var r=e.checkIfPageExists(t);null===t||isNaN(t)||(r?(e.meta.currentPage=parseInt(t,10),e.changeDirectory(a)):e.pageDoesNotExist=!0)},e.setPaginationMessage=function(t,r,i){0===i&&(t=0,r=0),e.paginationMessage=a.maketext("Displaying [numf,_1] to [numf,_2] out of [quant,_3,item,items]",t,r,i)},e.updatePagination=function(t){e.meta.totalItems=parseInt(t.total_records),e.meta.currentPage=parseInt(t.current_page),e.meta.pageSize=parseInt(t.page_size),e.meta.limit=e.meta.totalItems<e.meta.pageSize?e.meta.totalItems:e.meta.currentPage*e.meta.pageSize,e.setPaginationMessage(e.meta.start,e.meta.limit,e.meta.totalItems)},e.checkIfPageExists=function(t){return t*e.meta.page_size>e.meta.total_records?!1:!0},e.selectItem=function(t){e.selectedItemName=t.parsedName,-1!==t.type.indexOf("dir")?e.changeDirectory(t.fullPath):(e.selectedItemExists=t.exists,e.loadingData=!0,r.listBackups(t.fullPath).then(function(t){e.backupList=t}).catch(function(e){o.add({type:"danger",message:e,closeable:!0,group:"cpanel-restoration"})}).finally(function(){e.loadingData=!1}))},e.getBackupListForDirectory=function(){e.selectedItemName=e.currentPath,e.loadingData=!0,r.listBackups(e.currentPath).then(function(t){e.backupList=t}).catch(function(e){o.add({type:"danger",message:e,closeable:!0,group:"cpanel-restoration"})}).finally(function(){e.loadingData=!1})},e.addPaths=function(t){e.currentDirectoryContent=[];for(var a=0,r=t.length;r>a;a++)t[a].path=e.currentPath,t[a].fullPath=e.currentPath+t[a].name,t[a].parsedName=t[a].name.replace(/\s/g," "),e.currentDirectoryContent.push(t[a]);e.meta.totalItems=e.currentDirectoryContent.length},e.restore=function(c){e.selectedFilePath=c.path,e.selectedBackupID=c.backupID,i.setBackupType(c.type);var s=n.open({templateUrl:"restoreModalContent.tmpl",controller:"restoreModalController",resolve:{fileExists:e.selectedItemExists}});s.result.then(function(i){i&&(e.dataRestoring=!0,r.restore(e.selectedFilePath,e.selectedBackupID).then(function(r){if(r.success)if("file"===c.type||"symlink"===c.type)o.add({type:"success",message:a.maketext("The system successfully restored the “[_1]” backup file from the date “[_2]”.",t.escape(e.selectedFilePath),t.escape(e.selectedBackupID)),autoClose:1e4,group:"cpanel-restoration"});else{if("dir"!==c.type)throw"DEVELOPER ERROR: invalid backup type";o.add({type:"success",message:a.maketext("The system successfully restored the “[_1]” backup directory from the date “[_2]”.",t.escape(e.selectedFilePath),t.escape(e.selectedBackupID)),autoClose:1e4,group:"cpanel-restoration"})}}).catch(function(e){if("file"===c.type||"symlink"===c.type)o.add({type:"danger",message:a.maketext("File restoration failure: [_1]",e),closeable:!0,group:"cpanel-restoration"});else{if("dir"!==c.type)throw"DEVELOPER ERROR: invalid backup type";o.add({type:"danger",message:a.maketext("Directory restoration failure: [_1]",e),closeable:!0,group:"cpanel-restoration"})}}).finally(function(){e.dataRestoring=!1}))})},e.init=function(){e.currentPath="/",e.initialDataLoaded=!1,e.currentDirectoryContent=[],e.meta={showPager:!0,maxPages:0,totalItems:0,currentPage:1,pageSize:10,pageSizes:[10,20,50,100],start:1,limit:10},c.get("file_restoration_page_size").then(function(t){e.meta.pageSize=t[0].value||10,r.listDirectory("/",e.meta.start,e.meta.pageSize).then(function(t){e.currentPath="/",e.buildBreadcrumb(),e.addPaths(t.data);var a=t.meta.paginate;e.updatePagination(a)},function(t){e.noMetadataError=t}).finally(function(){e.initialDataLoaded=!0})})},e.init()}]);return i}),define("app/index",["angular","cjt/core","cjt/modules","ngRoute","uiBootstrap"],function(e,t){"use strict";return function(){e.module("App",["ngRoute","ui.bootstrap","cjt2.cpanel"]);var a=require(["cjt/bootstrap","cjt/views/applicationController","app/services/backupAPI","app/filters/fileSizeFilter","app/views/list"],function(a){var r=e.module("App");r.config(["$routeProvider",function(e){e.when("/list/",{controller:"listController",templateUrl:t.buildFullPath("file_and_directory_restoration/views/list.ptt")}),e.otherwise({redirectTo:"/list/"})}]),a()});return a}});