define("app/services/backupAPI",["angular","cjt/util/locale","cjt/util/parse","cjt/io/uapi-request","cjt/services/APIService","cjt/io/uapi"],function(e,t,r,n){"use strict";var a;try{a=e.module("App")}catch(o){a=e.module("App",[])}a.factory("backupAPIService",["APIService",function(a){function o(e){var r=e.data,n=[];return r.forEach(function(e){if(e.lastModifiedTime=t.local_datetime(parseInt(e.mtime,10),"datetime_format_short"),!c.hasOwnProperty(e.backupType))throw"DEVELOPER ERROR: Invalid backup type";e.backupType=c[e.backupType],e.type=s[e.type],n.push(e)}),n}function i(e){var t=[];return e.data.forEach(function(e){e.conflict=r.parsePerlBoolean(e.conflict),e.exists=r.parsePerlBoolean(e.exists),t.push(e)}),e.data=t,e}var c={compressed:t.maketext("Compressed"),uncompressed:t.maketext("Uncompressed"),incremental:t.maketext("Incremental")},s={file:t.maketext("File"),dir:t.maketext("Directory"),symlink:t.maketext("Symlink")},u=function(){};return u.prototype=new a,e.extend(u.prototype,{listDirectoryContents:function(e,t,r){var a=new n.Class;a.initialize("Restore","directory_listing"),a.addArgument("path",e),r&&a.addPaging(t,r);var o=this.deferred(a,{transformAPISuccess:i,transformAPIFailure:function(e){return e.error}});return o.promise},listBackups:function(e,t){var r=new n.Class;r.initialize("Restore","query_file_info"),r.addArgument("path",e),r.addArgument("exists",t);var a=this.deferred(r,{transformAPISuccess:o,transformAPIFailure:function(e){return e.error}});return a.promise},restoreBackup:function(e,t){var r=new n.Class;r.initialize("Restore","restore_file"),r.addArgument("backupID",t),r.addArgument("path",e),r.addArgument("overwrite",1);var a=this.deferred(r,{transformAPISuccess:function(e){return e.data},transformAPIFailure:function(e){return e.error}});return a.promise}}),new u}])}),define("app/filters/fileSizeFilter",["angular","cjt/util/locale"],function(e,t){"use strict";var r;try{r=e.module("App")}catch(n){r=e.module("App",[])}r.filter("convertedSize",function(){return function(e){return t.format_bytes(e)}})}),define("app/views/list",["angular","lodash","cjt/util/table","cjt/util/locale","cjt/util/parse","cjt/decorators/paginationDecorator","cjt/directives/actionButtonDirective","cjt/validator/datatype-validators","app/filters/fileSizeFilter","app/services/backupAPI","cjt/services/alertService","cjt/directives/alert","cjt/directives/alertList","cjt/services/cpanel/componentSettingSaverService"],function(e,t,r,n,a){"use strict";var o=e.module("App");o.value("PAGE",PAGE);var i=o.controller("listController",["$scope","$anchorScroll","PAGE","backupAPIService","alertService","componentSettingSaverService",function(e,o,i,c,s,u){function p(e){return 0!==e.indexOf("/")&&(e="/"+e),e}function l(t,r,n){g(),c.listDirectoryContents(t,r,n).then(function(e){var t=y(e.data);d(t,e.meta.paginate)}).catch(function(t){e.noMetadataMessage=t}).finally(function(){e.actions.loadingUI=!1,e.actions.loadingData=!1,e.emptyDirectory=0===e.directoryContents.length?!0:!1})}function d(e,t){B.load(e),S(t),f(t)}function f(t){e.directoryContentsMeta.pageNumber=1,B.update(),e.directoryContentsMeta.maxPages=parseInt(t.total_pages,10),e.directoryContentsMeta.totalItems=parseInt(t.total_records,10),e.directoryContentsMeta.start=parseInt(t.current_record,10),e.directoryContentsMeta.pageNumber=t.current_page,e.directoryContentsMeta.limit=e.directoryContentsMeta.start+e.directoryContentsMeta.pageSize>e.directoryContentsMeta.totalItems?e.directoryContentsMeta.totalItems:e.directoryContentsMeta.start+e.directoryContentsMeta.pageSize-1,e.directoryContents=B.getList(),e.directoryContentsPaginationMessage=B.paginationMessage()}function g(){B.items=[],B.filteredList=[],B.last_id=0}function y(t){var r=[];return t.forEach(function(t){t.backupPath&&t.parentDir||("/"===e.currentDirectory?(t.backupPath="/"+t.name,t.parentDir="/"):(t.backupPath=e.currentDirectory+t.name,t.parentDir=e.currentDirectory)),r.push(t)}),e.parentDirectory=e.currentDirectory,r}function m(t){var r=t.split("/");e.breadCrumb=r.slice(1,r.length-1)}function b(){for(var t="/",r=0,n=e.breadCrumb.length-1;n>r;r++)t=t+e.breadCrumb[r]+"/";return t}function C(){A.update(),e.backupsMeta=A.getMetadata(),e.backupList=A.getList(),e.backupsPaginationMessage=A.paginationMessage()}function k(t,r,n){return e.clearBackupList(),c.listBackups(t,r).then(function(t){r&&(e.doesContentExist=a.parsePerlBoolean(t[0].exists)),o("viewContent"),e.isContentTypeDirectory="Directory"===t[0].type?!0:!1,e.isBackupSelected=!0,A.load(t),C()}).catch(function(t){e.getBackupsError=t}).finally(function(){r||(e.doesContentExist=n),e.selectedContent=t,e.actions.loadingBackups=!1})}function v(t){u.get(t).then(function(r){r?(e.directoryContentsMeta.pageSize=r.pageSize,l(e.currentDirectory,e.directoryContentsMeta.pageNumber,e.directoryContentsMeta.pageSize)):D(t)}).catch(function(e){s.add({type:"danger",message:e,group:"backup-restoration",closeable:!0})})}function h(t){u.set(t,{pageSize:e.directoryContentsMeta.pageSize}).then(function(){l(e.currentDirectory,e.directoryContentsMeta.pageNumber,e.directoryContentsMeta.pageSize)}).catch(function(e){s.add({type:"danger",message:e,group:"backup-restortion",closeable:!0})})}function D(e){u.register(e).then(function(){h(e,!0)}).catch(function(e){s.add({type:"danger",message:e,group:"backup-restoration",closeable:!0})})}function M(r){return e.actions.restoring=!0,c.restoreBackup(r.path,r.backupID).then(function(){s.add({type:"success",message:n.maketext("The system successfully restored the “[_1]” backup file from the date “[_2]”.",t.escape(r.path),t.escape(r.backupDate)),autoClose:1e4,group:"backup-restoration"}),e.clearBackupList(),e.goToDirectory(e.currentDirectory)}).catch(function(e){s.add({type:"danger",message:e,closeable:!0,group:"backup-restoration"})}).finally(function(){e.actions.restoring=!1,e.toggleRestoreConfirmation()})}function P(t){return t*e.directoryContentsMeta.page_size>e.directoryContentsMeta.total_records?!1:!0}function S(t){for(var r=[],n=1;n<=t.total_pages;)n.toString(),r.push(n),parseInt(n,10),n++;e.goToPages=r}function I(){var t="pagination";e.userHomeDirDisplay=i.homeDir+"/",e.navigateMethod="input",e.dirContentsPanelOpen=!0,e.backupsPanelOpen=!0,e.currentDirectory="/",e.homeDir="/",e.noMetadataMessage="",e.isPathInputEmpty=!0,e.directoryContentsMeta=B.getMetadata(),e.backupsMeta=A.getMetadata(),e.doesContentExistInfo=n.maketext("When you restore a backup, the system will overwrite existing files and restore deleted files."),e.findByPathInfo=n.maketext("Enter the exact path to the file or directory that you wish to restore."),e.actions={loadingUI:!0,loadingData:!1,loadingBackups:!1},v(t)}var B=new r;B.setSort("name","asc");var A=new r;A.setSort("backupDate,backupType,lastModifiedTime,fileSize","desc"),e.setDirectoryContentsPage=function(t){e.clearBackupList(),e.actions.loadingData=!0,t?h("pagination"):l(e.currentDirectory,e.directoryContentsMeta.pageNumber,e.directoryContentsMeta.pageSize)},e.navigateBreadcrumb=function(t){e.clearBackupList(),e.actions.loadingData=!0;for(var r="/",n=0,a=e.breadCrumb.length;a>n;n++){if(t===e.breadCrumb[n]){r=r+e.breadCrumb[n]+"/";break}r=r+e.breadCrumb[n]+"/"}e.currentDirectory=r;var o=1;l(e.currentDirectory,o,e.directoryContentsMeta.pageSize),m(e.currentDirectory)},e.goToDirectory=function(t){e.actions.loadingData=!0,"/"===t&&(e.breadcrumb=""),e.clearBackupList(),e.currentDirectory!==t&&(e.directoryContentsMeta.pageNumber=1),e.currentDirectory=t;var r=e.currentDirectory.length;"/"!==e.currentDirectory.charAt(r-1)&&(e.currentDirectory=e.currentDirectory+"/"),l(e.currentDirectory,e.directoryContentsMeta.pageNumber,e.directoryContentsMeta.pageSize),m(e.currentDirectory)},e.toggleSelectedBackup=function(t){e.backupSelected=t===e.backupSelected?"":t},e.listBackups=function(t){var r=0;return e.actions.loadingBackups=!0,k(t.backupPath,r,t.exists)},e.toggleRestoreConfirmation=function(t){t?(e.confirmSelected=t.backupDate,e.isConfirmingRestoration=!0):(e.confirmSelected="",e.isConfirmingRestoration=!1)},e.restoreSelectedBackup=function(e){return M(e)},e.goToParentDirectory=function(){e.actions.loadingData=!0,e.currentDirectory=b();var t=1;l(e.currentDirectory,t,e.directoryContentsMeta.pageSize),m(e.currentDirectory)},e.findByPathInput=function(t){var r=1;return t=p(t),e.getBackupsError="",e.selectedContent=t,k(t,r)},e.goToPage=function(t,r){var n=P(t);null===t||isNaN(t)||(n?l(r,t,e.directoryContentsMeta.pageSize):e.pageDoesNotExist=!0)},e.sortDirectoryContentsTable=function(){var t=e.directoryContentsMeta.totalItems;if(e.directoryContentsMeta.pageNumber>=2){var r=e.directoryContentsMeta.pageNumber;B.meta.pageNumber=1,B.update(),B.meta.pageNumber=r}else B.update();e.directoryContentsMeta.totalItems=t,e.directoryContents=B.getList()},e.sortBackupsTable=function(){A.update(),e.backupList=A.getList(),e.backupsPaginationMessage=A.paginationMessage()},e.clearBackupList=function(){e.isConfirmingRestoration=!1,e.getBackupsError="",e.isBackupSelected=!1,e.selectedContent=""},e.checkForEmptyInput=function(t){e.isPathInputEmpty=""===t?!0:!1},e.getBackupsPanelClass=function(e){var t="panel panel-default";return e&&(t+=" restorationPanel"),t},e.getDirContentsPanelClass=function(e){var t="panel panel-default";return e&&(t+=" restorationPanel"),t},e.scrollToBackupList=function(){o("viewContent")},I()}]);return i}),define("app/index",["angular","cjt/core","cjt/modules","uiBootstrap","ngRoute"],function(e,t){"use strict";return function(){e.module("App",["ui.bootstrap","cjt2.cpanel"]);var r=require(["cjt/bootstrap","cjt/views/applicationController","app/services/backupAPI","app/filters/fileSizeFilter","app/views/list"],function(r){var n=e.module("App");n.config(["$routeProvider",function(e){e.when("/list/",{controller:"listController",templateUrl:t.buildFullPath("file_and_directory_restoration/views/list.ptt")}),e.otherwise({redirectTo:"/list/"})}]),r()});return r}});