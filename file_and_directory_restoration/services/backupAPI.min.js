define(["angular","cjt/util/locale","cjt/io/uapi-request","cjt/services/APIService","cjt/io/uapi"],function(angular,LOCALE,APIREQUEST){"use strict";var app;try{app=angular.module("App")}catch(e){app=angular.module("App",[])}app.factory("backupAPIService",["APIService",function(APIService){var validBackupTypes={compressed:LOCALE.maketext("Compressed"),uncompressed:LOCALE.maketext("Uncompressed"),incremental:LOCALE.maketext("Incremental")};function parseBackupData(backupData){var backups=backupData.data;var parsedBackups=[];backups.forEach(function(backup){backup.lastModifiedTime=LOCALE.local_datetime(parseInt(backup.mtime,10),"datetime_format_medium");if(validBackupTypes.hasOwnProperty(backup.backupType)){backup.backupType=validBackupTypes[backup.backupType]}else{throw"DEVELOPER ERROR: Invalid backup type"}parsedBackups.push(backup)});return parsedBackups}var BackupAPIService=function(){};BackupAPIService.prototype=new APIService;angular.extend(BackupAPIService.prototype,{listDirectory:function(path,currentPage,pageSize){var apiCall=new APIREQUEST.Class;apiCall.initialize("Restore","directory_listing");apiCall.addArgument("path",path);if(pageSize){apiCall.addPaging(currentPage,pageSize)}var deferred=this.deferred(apiCall,{transformAPISuccess:function(response){return response},transformAPIFailure:function(response){return response.error}});return deferred.promise},listBackups:function(fullPath){var apiCall=new APIREQUEST.Class;apiCall.initialize("Restore","query_file_info");apiCall.addArgument("path",fullPath);var deferred=this.deferred(apiCall,{transformAPISuccess:parseBackupData,transformAPIFailure:function(response){return response.error}});return deferred.promise},restore:function(fullPath,backupID){var apiCall=new APIREQUEST.Class;apiCall.initialize("Restore","restore_file");apiCall.addArgument("backupID",backupID);apiCall.addArgument("path",fullPath);apiCall.addArgument("overwrite",1);var deferred=this.deferred(apiCall,{transformAPISuccess:function(response){return response.data},transformAPIFailure:function(response){return response.error}});return deferred.promise}});return new BackupAPIService}])});