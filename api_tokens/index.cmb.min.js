define("app/services/apiTokens",["angular","lodash","cjt/util/locale","cjt/io/uapi-request","cjt/io/batch-request","cjt/modules","cjt/io/api","cjt/io/uapi","cjt/services/APICatcher"],function(e,t,n,i,a){"use strict";var r="cpanel.apiTokens.services.apiTokens",s="APITokensService",o=["cjt2.services.apicatcher"],c=["APICatcher","$q","$log"],l=function(e,n,i,a){this.id=e,this.new=!1,this.label=e,this.unrestricted=n,t.isBoolean(n)||(this.unrestricted=n&&"1"===n.toString()),this.features=i,this.createdOn=parseInt(a,10)},u=function(r,s){var o=function(){};return o.prototype=Object.create(r),t.assign(o.prototype,{_featuresMetadata:null,_tokens:[],_promise:function(){return r.promise.apply(this,arguments)},_apiCall:function(e,t,n){var a=new i.Class;return a.initialize(e,t,n),a},_batchAPICall:function(e){var t=new a.Class(e);return t},_processAPITokenResult:function(e){var t=e.name,n=e.has_full_access,i=e.features,a=e.create_time;return new l(t,n,i,a)},_processAPITokensResults:function(e){var t=e.data;return this._tokens=t.map(this._processAPITokenResult.bind(this)),this._tokens},_fetchTokens:function(){var e=this._apiCall("Tokens","list");return e},_deleteToken:function(e){var t=this._apiCall("Tokens","revoke",{name:e});return t},_processFeatureResult:function(e,t,n,i){return{label:n,id:t,installed:e&&"1"===e.toString(),badges:i}},_processFeaturesResults:function(i){var a=this,r=i.data;if(r){var s=[];e.forEach(r,function(e,t){var i=t,r=[];if(a._featuresMetadata&&a._featuresMetadata[t]){var o=a._featuresMetadata[t];i=o.name,"1"===o.is_cpaddon.toString()&&r.push(n.maketext("[asis,cPAddon]")),"1"===o.is_plugin.toString()&&r.push(n.maketext("Plugin"))}s.push(a._processFeatureResult(e,t,i,r))});var o=s.filter(function(e){return e.installed});return t.sortBy(o,function(e){return e.label})}},_getFeatures:function(){var e=this._apiCall("Features","list_features");return e},_processFeatureMetadataResult:function(e){var t=e.data;this._featuresMetadata={},t&&t.forEach(function(e){this._featuresMetadata[e.id]=e},this)},fetchTokens:function(){var e=this._fetchTokens();return this._promise(e).then(this._processAPITokensResults.bind(this))},getTokens:function(){return this._tokens},deleteTokens:function(e){var t=this,n=e.map(t._deleteToken.bind(t)).map(t._promise.bind(t));return s.all(n).then(t.fetchTokens.bind(t))},getFeatures:function(){var e=this,t=this._getFeatures(),n=[t];e._featuresMetadata||n.unshift(this._apiCall("Features","get_feature_metadata"));var i=e._batchAPICall(n);return e._promise(i).then(function(t){if(t.data=t.data.map(function(e){return e.parsedResponse}),n.length>1){var i=t.data.shift();e._processFeatureMetadataResult.call(e,i)}return t.data.pop()}).then(e._processFeaturesResults.bind(e))},_processTokenCreationResults:function(e,t,n,i){var a=i.data,r=new l(e,t,n,(new Date).getTime()/1e3);return r.new=!0,this._tokens.push(r),a.token},createToken:function(e,t,n){var i;return i=t?this._apiCall("Tokens","create_full_access",{name:e}):this._apiCall("Tokens","create_limited",{name:e,feature:n}),this._promise(i).then(this._processTokenCreationResults.bind(this,e,t,n))},getTokenById:function(e){for(var t=this.getTokens(),n=0;n<t.length;n++)if(t[n].id===e)return t[n]},updateTokenRestrictions:function(e,t,n){var i,a=this;return i=t?this._apiCall("Tokens","set_full_access",{name:e}):this._apiCall("Tokens","set_features",{name:e,feature:n}),a._promise(i).then(function(){var i=a.getTokenById(e);i.unrestricted=t,i.features=n})},renameToken:function(e,t){var n=this._apiCall("Tokens","rename",{name:e,new_name:t});return this._promise(n)}}),new o};c.push(u);var d=e.module(r,o);return d.factory(s,c),{"class":u,serviceName:s,namespace:r}}),define("app/directives/tableShowing",["angular","cjt/util/locale","cjt/core"],function(e,t,n){"use strict";var i="directives/tableShowing.ptt",a="api_tokens/"+i,r=n.config.debug?n.buildFullPath(a):i,s="cpanel.apiTokens.tableShowing.directive",o=e.module(s,[]),c=function(e){e.getShowingText=function(){return t.maketext("[_1] - [_2] of [_3]",e.start,e.limit,e.total)}};return o.directive("tableShowing",function(){return{templateUrl:r,restrict:"EA",scope:{start:"=",limit:"=",total:"="},transclude:!0,controller:["$scope",c]}}),{"class":c,namespace:s,template:i}}),define("app/decorators/paginationDecorator",["angular","cjt/core","cjt/util/locale","uiBootstrap"],function(e,t,n){"use strict";var i,a="cpanel.emailAccounts",r="decorators/pagination.phtml",s="email_accounts/"+r;try{i=e.module(a)}catch(o){i=e.module(a,["ui.bootstrap.pagination"])}return i.config(["$provide",function(e){e.decorator("uibPaginationDirective",["$delegate",function(e){var i=e[0],a=function(e,t){e&&e.forEach(function(e){e.id=t+"_"+e.text})},o=function(e){e&&e.forEach(function(e){e.ariaLabel=n.maketext("Go to page “[_1]”.",e.text)})},c=function(e,t){return n.maketext("Page [numf,_1] of [numf,_2]",e,t)};i.templateUrl=t.config.debug?t.buildFullPath(s):r;var l=i.link;return i.compile=function(){return function(e,t,i,r){var s=r[0];l.apply(this,arguments),e.parentId=i.id,e.ariaLabels={title:n.maketext("Pagination"),firstPage:n.maketext("Go to first page."),previousPage:n.maketext("Go to previous page."),nextPage:n.maketext("Go to next page."),lastPage:n.maketext("Go to last page.")},e.updateCurrentSelectedText=c;var u=s.render;s.render=function(){u.apply(s),a(e.pages,e.parentId),o(e.pages)}}},e}])}]),{namespace:a,template:r}}),define("app/directives/itemLister",["angular","lodash","cjt/core","app/directives/tableShowing","app/decorators/paginationDecorator","ngSanitize","ngRoute","cjt/modules","cjt/directives/pageSizeButtonDirective","cjt/services/cpanel/componentSettingSaverService","cjt/directives/toggleSortDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective","cjt/directives/indeterminateState","cjt/filters/startFromFilter","cjt/decorators/paginationDecorator"],function(e,t,n,i,a){"use strict";var r=[i.namespace,a.namespace,"ngRoute","ngSanitize","cjt2.filters.startFrom"],s="cpanel.apiTokens.itemLister.directive",o="apiTokensItemLister",c=["$routeParams","$scope","$filter","$log","$window","componentSettingSaverService","ITEM_LISTER_CONSTANTS"],l=function(n,i,a,r,s,c,l){i.viewCallbacks=[],i.checkAll={indeterminate:!1,all:!1};var u={filter:a("filter"),orderBy:a("orderBy"),startFrom:a("startFrom"),limitTo:a("limitTo")};i._filter=function(e){return""!==i.filterValue?u.filter(e,i.filterValue,!1):e},i._sort=function(e){return""!==i.sort.sortDirection&&""!==i.sort.sortBy?u.orderBy(e,i.sort.sortBy,"asc"!==i.sort.sortDirection):e},i._paginate=function(e){if(i.totalItems>t.min(i.pageSizes)){var n=(i.currentPage-1)*i.pageSize,a=i.pageSize;e=u.startFrom(e,n),e=u.limitTo(e,a),i.showPager=!0,i.start=n+1,i.limit=n+e.length}else i.showPager=!1,i.start=0===e.length?0:1,i.limit=e.length;return e},i._updatedListerState=function(){if(!i.loadingInitialState){var e={pageSize:i.pageSize,sort:{sortDirection:i.sort.sortDirection,sortBy:i.sort.sortBy}};c.set(o,e)}},i._itemInteracted=function(e,t){t.interactionID&&i._updatedListerState(t.interactionID)},this.registerViewCallback=function(e){i.viewCallbacks.push(e),e(i.filteredItems)},this.getHeaderItems=function(){return i.headerItems},this.deregisterViewCallback=function(e){for(var t=i.viewCallbacks.length-1;t>=0;t--)i.viewCallbacks[t]===e&&i.viewCallbacks.splice(t,1)},i.fetch=function(){var t=[];return t=i._filter(i.items),i.totalItems=t.length,t=i._sort(t),t=i._paginate(t),i.filteredItems=t,i._updatedListerState(),e.forEach(i.viewCallbacks,function(e){e(i.filteredItems)}),i.$emit(l.ITEM_LISTER_UPDATED_EVENT,{meta:{filterValue:i.filterValue},items:t}),i._updateSelectAllState(),t},i.focusSearch=function(){e.element(document).find("#"+i.parentID+"_search_input").focus(),s.scrollTop=0},i.tableConfigurationClicked=function(e){i.$emit(l.TABLE_ITEM_BUTTON_EVENT,{actionType:"tableConfigurationClicked",config:e})},i._updateSelectAllState=function(){i.selectedItems=i.filteredItems.filter(function(e){return e.selected}),i.checkAll.all=i.selectedItems.length&&i.filteredItems.length&&i.selectedItems.length===i.filteredItems.length?!0:!1},i.getIndeterminateState=function(){return i.selectedItems.length&&i.filteredItems.length&&i.filteredItems.length!==i.selectedItems.length},i.toggleSelectAll=function(){i.selectedItems.length<i.filteredItems.length?(i.filteredItems.forEach(function(e){e.selected=!0}),i.$emit(l.ITEM_LISTER_SELECT_ALL,{items:i.filteredItems})):(i.filteredItems.forEach(function(e){e.selected=!1}),i.$emit(l.ITEM_LISTER_DESELECT_ALL,{items:i.filteredItems})),i._updateSelectAllState()},i.$on(l.TABLE_ITEM_BUTTON_EVENT,i._itemInteracted),i.$on(l.TABLE_ITEM_SELECTED,i._updateSelectAllState),i.$on(l.TABLE_ITEM_DESELECTED,i._updateSelectAllState),e.extend(i,{maxPages:5,totalItems:i.items.length,filteredItems:[],currentPage:1,pageSize:20,pageSizes:[20,100,500],start:0,limit:20,filterValue:"",sort:{sortDirection:"asc",sortBy:i.headerItems.length?i.headerItems[0].field:""}},{filterValue:n.q}),i._savedStateLoaded=function(t){e.extend(i,t,{filterValue:n.q})};var d=c.register(o);d&&(i.loadingInitialState=!0,d.then(i._savedStateLoaded,r.error).finally(function(){i.loadingInitialState=!1,i.fetch()})),i.$on("$destroy",function(){c.unregister(o)}),i.fetch(),i.$watch("items",i.fetch)},u="directives/itemLister.ptt",d="api_tokens/"+u,f=n.config.debug?n.buildFullPath(d):u,p=["$window","$log","componentSettingSaverService"],m=function(n,i,a){t.isUndefined(a.canSelectAll)||"0"===a.canSelectAll||(n.canSelectAll=!0),n.controlsBlock=null,n.contentBlock=null,n._attachControls=function(e){n.controlsBlock.append(e)},n._attachOthers=function(e){e.setAttribute("id",n.parentID+"_transcludePoint"),e.setAttribute("ng-if","filteredItems.length"),n.contentBlock.replaceWith(e)},n._attachTransclude=function(t){e.element(t).hasClass("lister-controls")?n._attachControls(t):n._attachOthers(t)},n._findTranscludes=function(){n.controlsBlock=i.find("#"+n.parentID+"_transcludedControls"),n.contentBlock=i.find("#"+n.parentID+"_transcludePoint");var t=i.find("div.transcluded"),a=t.children();e.forEach(a,n._attachTransclude,n),t.remove()},setTimeout(n._findTranscludes,2)},h=function(){return{templateUrl:f,restrict:"EA",scope:{parentID:"@id",items:"=",headerItems:"=",tableConfigurations:"=",createRoute:"@"},transclude:!0,replace:!0,link:m,controller:c.concat(l)}},g=e.module(s,r);return g.directive("itemLister",p.concat(h)),{"class":l,namespace:s,link:m,template:u}}),define("app/filters/htmlSafeString",["angular","lodash"],function(e,t){"use strict";var n="cpanel.apiTokens.htmlSafeString.filter",i=[],a=[],r=function(){return t.escape},s=e.module(n,i);return s.filter("htmlSafeString",a.concat(r)),{"class":r,namespace:n}}),define("app/directives/itemListerView",["angular","lodash","cjt/core","cjt/util/locale","app/filters/htmlSafeString"],function(e,t,n,i,a){"use strict";var r="cpanel.apiTokens.itemListerView.directive",s=[a.namespace],o="directives/itemListerView.ptt",c="api_tokens/"+o,l=n.config.debug?n.buildFullPath(c):o,u=["$scope","$location","ITEM_LISTER_CONSTANTS"],d=function(e,t,n){e.toggleSelection=function(t){t.selected?e.$emit(n.TABLE_ITEM_SELECTED,{item:t}):e.$emit(n.TABLE_ITEM_DESELECTED,{item:t})},e.getCreationLabel=function(e){return i.local_datetime(e,"datetime_format_medium")},e.getRestrictionLabel=function(e){return i.maketext(e?"Unrestricted":"Limited")},e.getItems=function(){return e.items},e.manageToken=function(e){t.path("/manage").search("token",e.id)}},f=e.module(r,s);f.value("PAGE",PAGE);var p=function(e,t,n,i){e.items=[],e.headerItems=i.getHeaderItems(),e.updateView=function(t){e.items=t},i.registerViewCallback(e.updateView.bind(e)),e.$on("$destroy",function(){i.deregisterViewCallback(e.updateView)})};return f.directive("itemListerView",function(){return{templateUrl:l,restrict:"EA",replace:!0,require:"^itemLister",link:p,controller:u.concat(d)}}),{"class":d,namespace:r,link:p,template:o}}),define("app/validators/uniqueTokenName",["angular","cjt/util/locale","cjt/validator/validator-utils","app/services/apiTokens","cjt/validator/validateDirectiveFactory"],function(e,t,n,i){"use strict";var a,r={_lastFetch:0,_processLoadedTokens:function(e){return a=null,e&&(a={},e.forEach(function(e){a[e.id]=e})),a},_fetchTokens:function(){return a}},s={tokenNameIsUnique:function(e,i){var a=n.initializeValidationResult(),s=r._fetchTokens();return i&&e===i?a:((!s||e&&s[e])&&(a.isValid=!1,a.add("tokenNameIsUnique",t.maketext("This [asis,API] token name already exists on this account. Enter a different name."),"tokenNameIsUnique")),a)},validate:function(e,t,n,i,a){var o=(new Date).getTime();if(r._fetchTokens()&&o-r._lastFetch<1e3){var c=s.tokenNameIsUnique(n,i,a);return t.resolve(c)}return r._lastFetch=o,e.fetchTokens().then(function(e){r._processLoadedTokens(e);var o=s.tokenNameIsUnique(n,i,a);return t.resolve(o)})}},o=e.module("cjt2.validate");return o.run(["validatorFactory","$q",i.serviceName,function(e,t,n){var i={tokenNameIsUnique:s.validate.bind(s,n,t)};i.tokenNameIsUnique.async=!0,e.generate(i,t)}]),{methods:s,factoryMethods:r,name:"token-name-is-unique",description:"Validation to ensure the api Token is unique for this account.",version:1}}),define("app/views/create",["angular","lodash","cjt/util/locale","app/services/apiTokens","cjt/directives/copyField","app/validators/uniqueTokenName","cjt/modules","cjt/directives/actionButtonDirective","cjt/services/cpanel/componentSettingSaverService","cjt/directives/validationContainerDirective","cjt/directives/validationItemDirective","cjt/directives/toggleSwitchDirective","cjt/directives/searchDirective","cjt/directives/indeterminateState","cjt/services/alertService"],function(e,t,n,i,a){"use strict";var r="createAPITokenView",s=n.maketext("Create API Token"),o="cpanel.apiTokens.views.create",c="views/create.ptt",l=["cjt2.directives.validationContainer","cjt2.directives.validationItem","cjt2.directives.toggleSwitch","cjt2.directives.search","cjt2.directives.indeterminateState",a.namespace],u=["$scope","$location","alertService",i.serviceName,"componentSettingSaverService","CAN_CREATE_LIMITED","apiTokens","features"],d="CreateTokenController",f=function(t,i,a,o,c,l,u,d){t.canCreateLimited=l,t.pageTitle=s,t.RTL=n.is_rtl(),t.showAllHelp=!1,t.selectedFeatures=[],t.ui={stayAfterCopy:!1},t.checkAll={all:!1},t.features=d,t.apiTokens=u,t.working={},t.init=function(){c.register(r).then(function(e){e&&(t.showAllHelp=e.showAllHelp,t.ui.stayAfterCopy=e.stayAfterCopy)}),t.reset()},t.reset=function(e){t.working={name:"",unrestricted:l?!1:!0,features:{}},t.generatedToken=null,t.pageTitle=s,t.selectedFeatures=[],e&&e.$setPristine()},t._updateCSSS=function(){c.set(r,{showAllHelp:t.showAllHelp,stayAfterCopy:t.ui.stayAfterCopy})},t.toggleHelp=function(){t.showAllHelp=!t.showAllHelp,t._updateCSSS()},t._tokenCreated=function(e){t.generatedToken=e,t.pageTitle=n.maketext("Token Created Successfully"),t.apiTokens=o.getTokens();var i;return i=t.working.unrestricted?n.maketext("You successfully created an [output,strong,unrestricted] [asis,API] token “[_1]”.",t.working.name):n.maketext("You successfully created a [output,strong,limited-access] [asis,API] token “[_1]”.",t.working.name),a.success(i),e},t.create=function(e){return o.createToken(e.name,e.unrestricted,t.selectedFeatures).then(t._tokenCreated)},t.toggleSelectAllFeatures=function(){t.features.forEach(t.selectedFeatures.length<t.features.length?function(e){t.working.features[e.id]=!0}:function(e){t.working.features[e.id]=!1}),t.updateSelectedFeatures()},t.getFeaturesIndeterminateState=function(){return t.selectedFeatures.length&&t.features.length&&t.features.length!==t.selectedFeatures.length},t.updateSelectedFeatures=function(){t.selectedFeatures=[],e.forEach(t.working.features,function(e,n){e&&t.selectedFeatures.push(n)})},t.backToListView=function(){i.path("/")},t.tokenCopied=function(e){t.ui.stayAfterCopy?t.reset(e):t.backToListView()},t.stayAfterCopyChanged=function(){t._updateCSSS()},t.$on("$destroy",c.unregister.bind(c,r)),t.init()},p=e.module(o,l);p.controller(d,u.concat(f));var m={apiTokens:[i.serviceName,function(e){return e.fetchTokens()}],features:[i.serviceName,function(e){return e.getFeatures()}]};return{id:"createAPIToken",route:"/create",controller:d,"class":f,templateUrl:c,title:s,namespace:o,showResourcePanel:!0,resolve:m}}),define("app/views/list",["angular","lodash","cjt/util/locale","app/directives/itemLister","app/directives/itemListerView","app/services/apiTokens","app/views/create","cjt/modules","cjt/services/alertService","cjt/directives/actionButtonDirective"],function(e,t,n,i,a,r,s){"use strict";var o=n.maketext("List API Tokens"),c="cpanel.apiTokens.views.list",l="views/list.ptt",u=[i.namespace,a.namespace,r.namespace],d=["$scope","$location",r.serviceName,"alertService","apiTokens","ITEM_LISTER_CONSTANTS"],f="ListController",p=function(e,i,a,r,o,c){e.init=function(){e._apiTokens=o,e._filteredItems=[],e.selectedItems=[],e.confirmingDelete=!1,e.deletingTokens=!1,e.tableHeaderItems=[{field:"label",label:n.maketext("Token Name"),sortable:!0},{field:"createdOn",label:n.maketext("Created"),hiddenOnMobile:!0,sortable:!0},{field:"actions",label:"",sortable:!1}],["TABLE_ITEM_SELECTED","TABLE_ITEM_DESELECTED","ITEM_LISTER_SELECT_ALL","ITEM_LISTER_DESELECT_ALL"].forEach(function(t){e.$on(c[t],e._updatedSelected)}),e.$on(c.ITEM_LISTER_UPDATED_EVENT,function(t,n){e._filteredItems=n.items,e._updatedSelected()})},e._deleteTokenSuccess=function(t,a){e._apiTokens=a,r.success(n.maketext("The system successfully revoked the following [asis,API] [numerate,_1,token,tokens]: [list_and_quoted,_1]",t)),0===e._apiTokens.length&&i.path(s.route),e.confirmingDelete=!1,e.deletingTokens=!1},e._updatedSelected=function(){e.selectedItems=e._filteredItems.filter(function(e){return e.selected})},e.deleteTokens=function(n){var i=[],r=[];return n.forEach(function(e){r.push(e.id),i.push(t.escape(e.label))}),e.deletingTokens=!0,a.deleteTokens(r).then(e._deleteTokenSuccess.bind(e,i))},e.showDeletionConfirmationMessage=function(){e.confirmingDelete=!0},e.hideDeletionConfirmationMessage=function(){e.confirmingDelete=!1},e.confirmDeleteButtonLabel=function(){return n.maketext("Revoke Selected [asis,API] [numerate,_1,Token,Tokens]",e.selectedItems.length)},e.getItems=function(){return e._apiTokens},e.getSelectedFeatureNames=function(){return e.selectedItems.map(function(e){return e.id})},e.confirmDeleteMessage=function(){var i=e.getSelectedFeatureNames().map(t.escape);return n.maketext("Are you sure that you want to revoke the following [asis,API] [numerate,_1,token,tokens]: [list_and_quoted,_2]",i.length,i)},e.init()},m=e.module(c,u);m.controller(f,d.concat(p));var h={apiTokens:[r.serviceName,"$location",function(e,t){return e.fetchTokens().then(function(e){return e.length?e:(t.path(s.route),!1)})}]};return{id:"listAPITokens",route:"/",controller:f,"class":p,templateUrl:l,title:o,namespace:c,showResourcePanel:!1,resolve:h}}),define("app/views/manage",["angular","lodash","cjt/util/locale","app/services/apiTokens","app/filters/htmlSafeString","app/validators/uniqueTokenName","cjt/modules","cjt/services/alertService","cjt/directives/actionButtonDirective","cjt/services/cpanel/componentSettingSaverService","cjt/directives/validationContainerDirective","cjt/directives/validationItemDirective","cjt/directives/toggleSwitchDirective","cjt/directives/searchDirective","cjt/directives/indeterminateState"],function(e,t,n,i,a){"use strict";var r="manageAPITokenView",s=n.maketext("Manage [asis,API] Token"),o="cpanel.apiTokens.views.manage",c="views/manage.ptt",l=["cjt2.directives.validationContainer","cjt2.directives.validationItem","cjt2.directives.toggleSwitch","cjt2.directives.search","cjt2.directives.indeterminateState",a.namespace],u=["$scope","$location","$routeParams","alertService",i.serviceName,"componentSettingSaverService","CAN_CREATE_LIMITED","apiTokens"],d="ManageTokenController",f=function(i,a,o,c,l,u,d,f){i.pageTitle=s,i.RTL=n.is_rtl(),i.showAllHelp=!1,i.ui={confirmingRevocation:!1},i.selectedFeatures=[],i.checkAll={all:!1},i.apiTokens=f,i.working={},i.init=function(){u.register(r).then(function(e){e&&(i.showAllHelp=e.showAllHelp,i.stayOnView=e.stayOnView)});var e=o.token,t=l.getTokenById(e);return t?(i.canEditFeatureRestrictions=!t.unrestricted||d,i.current=t,i.working={name:t.id,unrestricted:t.unrestricted,features:{}},t.features.forEach(function(e){i.working.features[e]=!0,i.selectedFeatures.push(e)}),void(i.current.unrestricted||l.getFeatures().then(i._featuresLoaded))):void a.path("/")},i._updateCSSS=function(){u.set(r,{showAllHelp:i.showAllHelp})},i._featuresLoaded=function(e){i.features=e},i.toggleHelp=function(){i.showAllHelp=!i.showAllHelp,i._updateCSSS()},i._tokenRenamed=function(e,i){c.success(n.maketext("You have successfully renamed the API Token “[_1]” to “[_2]”.",t.escape(e),t.escape(i)))},i._renameToken=function(e,t){return l.renameToken(e,t).then(i._tokenRenamed.bind(i,e,t))},i._getFeatureById=function(e){for(var t=i.features,n=0;n<t.length;n++)if(t[n].id===e)return t[n]},i._tokenRestrictionUpdated=function(e,a,r){if(a)c.success({message:n.maketext("You have successfully set the [asis,API] token “[_1]” to unrestricted.",t.escape(e)),replace:!1});else{var s=r.map(function(e){return i._getFeatureById(e).label}).map(t.escape);c.success({message:n.maketext("The [asis,API] Token “[_1]” is now limited to the following features: [list_and_quoted,_2].",e,s),replace:!1})}},i.update=function(e){var t,n=i.current,a=e.unrestricted!==i.current.unrestricted||i.selectedFeatures.sort().join()!==i.current.features.sort().join();if(n.id!==e.name&&(t=i._renameToken(n.id,e.name),a||t.finally(i.backToListView)),a){var r=l.updateTokenRestrictions.bind(l,e.name,e.unrestricted,i.selectedFeatures),s=i._tokenRestrictionUpdated.bind(i,e.name,e.unrestricted,i.selectedFeatures);t?t.then(r).then(s):t=r().then(s),t.finally(i.backToListView)}return t},i.unrestrictedToggled=function(){i.working.unrestricted||i.features||l.getFeatures().then(i._featuresLoaded)},i.toggleSelectAllFeatures=function(){i.working.features=i.working.features||{},i.features.forEach(i.selectedFeatures.length<i.features.length?function(e){i.working.features[e.id]=!0}:function(e){i.working.features[e.id]=!1}),i.updateSelectedFeatures()},i.getFeaturesIndeterminateState=function(){return i.selectedFeatures.length&&i.features.length&&i.features.length!==i.selectedFeatures.length},i.updateSelectedFeatures=function(){i.selectedFeatures=[],e.forEach(i.working.features,function(e,t){e&&i.selectedFeatures.push(t)})},i.backToListView=function(){a.path("/")},i.showRevokeConfirm=function(){i.ui.confirmingRevocation=!0},i.hideRevokeConfirm=function(){i.ui.confirmingRevocation=!1},i._tokenRevoked=function(e){c.success(n.maketext("You have successfully revoked the following [asis,API] [numerate,_1,token,tokens]: “[_1]”",t.escape(e)))},i.revokeToken=function(e){return l.deleteTokens([e.id]).then(i._tokenRevoked.bind(i,e.id)).then(i.backToListView)},i.$on("$destroy",u.unregister.bind(u,r)),i.init()},p=e.module(o,l);p.controller(d,u.concat(f));var m={apiTokens:[i.serviceName,function(e){return e.fetchTokens()}]};return{id:"manageAPIToken",route:"/manage",controller:d,"class":f,templateUrl:c,title:s,namespace:o,showResourcePanel:!0,resolve:m}}),define("app/index",["angular","cjt/core","cjt/util/locale","app/services/apiTokens","app/views/list","app/views/create","app/views/manage","app/filters/htmlSafeString","cjt/modules","cjt/directives/alertList","cjt/services/alertService","cjt/services/APICatcher","cjt/directives/loadingPanel","cjt/directives/breadcrumbs","ngRoute"],function(e,t,n,i,a,r,s,o){"use strict";var c="cpanel.apiTokens";return function(){var l=[],u=["ngRoute","cjt2."+t.applicationName,i.namespace,o.namespace];[a,r,s].forEach(function(e){e.breadcrumb=e.breadcrumb?e.breadcrumb:{id:e.id,name:e.title,path:e.route,parentID:e.parentID},l.push(e),u.push(e.namespace)});var d=e.module(c,u);return d.value("ITEM_LISTER_CONSTANTS",{TABLE_ITEM_BUTTON_EVENT:"TableItemActionButtonEmitted",TABLE_ITEM_SELECTED:"TableItemSelectedEmitted",TABLE_ITEM_DESELECTED:"TableItemDeselectedEmitted",ITEM_LISTER_UPDATED_EVENT:"ItemListerUpdatedEvent",ITEM_LISTER_SELECT_ALL:"ItemListerSelectAllEvent",ITEM_LISTER_DESELECT_ALL:"ItemListerDeselectAllEvent"}),d.value("CAN_CREATE_LIMITED",PAGE.canCreateLimited),d.controller("MainController",["$scope","$rootScope","alertService",function(e,t,i){function a(e){var t;return l.forEach(function(n,i){n.route===e&&(t=i)}),t}e.showResourcePanel=!0,e.mainPanelClasses="",e.sidePanelClasses="",e.updatePanelClasses=function(){e.sidePanelClasses="col-sm-4 col-md-4 hidden-xs",e.sidePanelClasses+=" ",e.sidePanelClasses+=n.is_rtl()?"pull-left":"pull-right",e.mainPanelClasses=e.showResourcePanel?"col-xs-12 col-sm-8 col-md-8":"col-xs-12"},t.$on("$routeChangeStart",function(){e.loading=!0,i.clear("danger")}),t.$on("$routeChangeSuccess",function(t,n){if(e.loading=!1,n){var i=a(n.$$route.originalPath);l[i]&&(e.currentTab=l[i],e.showResourcePanel=e.currentTab.showResourcePanel,e.activeTab=i,e.updatePanelClasses())}}),t.$on("$routeChangeError",function(){e.loading=!1})}]),require(["cjt/bootstrap"],function(e){d.config(["$routeProvider","$animateProvider",function(e,t){t.classNameFilter(/^((?!no-animate).)*$/),l.forEach(function(t){e.when(t.route,t)}),e.otherwise({redirectTo:"/"})}]),e("#content",c)}),d}});