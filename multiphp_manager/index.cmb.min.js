define("app/services/configService",["angular","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi","cjt/services/APIService"],function(e,t,s){"use strict";var o;try{o=e.module("App")}catch(a){o=e.module("App",["cjt2.services.api"])}o.factory("configService",["$q","APIService",function(e,o){return{convertResponseToList:function(e){var t=[];if(e.status){for(var s=e.data,o=0,a=s.length;a>o;o++){var i=s[o];i.version&&(i.displayPhpVersion=this.transformPhpFormat(i.version)),t.push(i)}var r=e.meta,n=r.paginate.total_records||s.length,c=r.paginate.total_pages||1;return{items:t,totalItems:n,totalPages:c}}return{items:[],totalItems:0,totalPages:0}},applyDomainSetting:function(o,a){var i=e.defer(),r=this,n=new s.Class;return n.initialize("LangPHP","php_set_vhost_versions"),n.addArgument("version",o),"undefined"!=typeof a&&a.length>0&&a.forEach(function(e,t){n.addArgument("vhost-"+t,e)}),t.promise(n.getRunArguments()).done(function(e){if(e=e.parsedResponse,e.status){var t=r.convertResponseToList(e);i.resolve(t)}else i.reject(e)}),i.promise},fetchList:function(o){var a=e.defer(),i=this,r=new s.Class;return r.initialize("LangPHP","php_get_vhost_versions"),o&&(o.sortBy&&o.sortDirection&&r.addSorting(o.sortBy,o.sortDirection,o.sortType),o.currentPage&&r.addPaging(o.currentPage,o.pageSize||10),o.filterBy&&o.filterCompare&&o.filterValue&&r.addFilter(o.filterBy,o.filterCompare,o.filterValue)),t.promise(r.getRunArguments()).done(function(e){if(e=e.parsedResponse,e.status){var t=i.convertResponseToList(e);a.resolve(t)}else a.reject(e.error)}),a.promise},fetchImpactedDomains:function(e,t){var a=new s.Class,i=new o;a.initialize("LangPHP","php_get_impacted_domains"),a.addArgument(e,t);var r=i.deferred(a);return r.promise},prepareList:function(e){return this.convertResponseToList(e)},transformPhpFormat:function(e){var t=e||"",s=/^\D+-(php)(\d{2,3})$/i;if(s.test(e)){var o=e.match(s),a=o[2].replace(/(\d)$/,".$1");t="PHP "+a+" ("+e+")"}return t}}}])}),define("app/views/impactedDomainsPopup",["angular","lodash","cjt/util/locale","uiBootstrap"],function(e){var t=e.module("App"),s=t.controller("impactedDomainsPopup",["$scope","$uibModalInstance","data",function(e,t,s){e.modalData={};var o=s;e.modalData=o,e.closeModal=function(){t.close()}}]);return s}),define("app/views/config",["angular","cjt/util/locale","lodash","uiBootstrap","cjt/services/alertService","cjt/directives/alert","cjt/directives/alertList","app/services/configService","app/views/impactedDomainsPopup"],function(e,t,s){"use strict";var o=e.module("App"),a=o.controller("config",["$scope","configService","$uibModal","$timeout","alertService",function(o,a,i,r,n){o.loadingVhostList=!1,o.phpVersionsEmpty=!0,o.selectedVersion={},o.phpVhostList=[],o.restrictedPhp={domainsSelected:[],showAlert:!1,alertInfo:"",showAllDomains:!1,showMore:!0},o.vhostSelected=!1;var c=[];o.totalSelectedDomains=0,o.checkdropdownOpen=!1,o.meta={sortReverse:!1,sortBy:"vhost",sortDirection:"asc",filterBy:"*",filterCompare:"contains",filterValue:"",maxPages:0,totalItems:o.phpVhostList.length,currentPage:1,pageSize:10,pageSizes:[10,20,50,100],start:0,limit:10};var l={loading:!1,warn:!1,show:!1,showMore:!1,text:""},p=function(){var e=[];return o.phpVhostList.forEach(function(t){t.rowSelected&&t.isRestricted&&e.push(t.vhost)}),e},d=function(){o.restrictedPhp.domainsSelected=p(),o.restrictedPhp.showMore=6<o.restrictedPhp.domainsSelected.length;var e=o.restrictedPhp.domainsSelected;if(e.length>0){o.restrictedPhp.showAlert=!0;var s=o.phpVersions.reduce(function(e,t){return"inherit"!==t.version&&e.push(t.displayPhpVersion),e},[]);o.restrictedPhp.alertInfo=t.maketext("The system administrator only allows this account to use the [asis,PHP] [numerate,_2,version,versions] [list_and,_1].",s,s.length)+" "+t.maketext("If you change the [asis,PHP] version for the following [numerate,_1,domain,domains], you cannot use this interface to change the [numerate,_1,domain,domains] back to use [numerate,_1,its,their] original version of [asis,PHP].",e.length)}else o.restrictedPhp.showAlert=!1};o.selectAllVhosts=function(){if(o.allRowsSelected)o.phpVhostList.forEach(function(e){e.rowSelected=!0,-1===c.indexOf(e.vhost)&&c.push(e.vhost)});else{var e=o.phpVhostList.map(function(e){return e.rowSelected=!1,e.vhost});c=s.difference(c,e),o.restrictedPhp.showAlert=!1}o.totalSelectedDomains=c.length,o.vhostSelected=o.totalSelectedDomains>0,o.restrictedPhp.domainsSelected=p(),o.restrictedPhp.showAlert&&d()};var h=function(e,o){o?(e.impactedDomains.loading=!0,a.fetchImpactedDomains("domain",e.vhost).then(function(o){var a=s.without(o.data.domains,e.vhost);o.status&&a.length>0&&(e.impactedDomains.show=e.impactedDomains.warn=e.rowSelected,e.impactedDomains.showMore=a.length>10,e.impactedDomains.text=t.maketext("A change to the “[output,strong,_1]” domain‘s PHP version affects the following domains:",e.vhost),e.impactedDomains.domains=s.sortBy(a))},function(e){n.add({type:"danger",message:e,closeable:!0,replace:!1,group:"multiphpManager"})}).finally(function(){e.impactedDomains.loading=!1})):e.impactedDomains.show=e.impactedDomains.warn=o};o.toggleRestrictedDomains=function(){o.restrictedPhp.showAllDomains=!o.restrictedPhp.showAllDomains},o.selectVhost=function(e){"undefined"!=typeof e&&(h(e,e.rowSelected),e.rowSelected?(c.push(e.vhost),o.allRowsSelected=o.phpVhostList.every(function(e){return e.rowSelected})):(c=c.filter(function(t){return t!==e.vhost}),o.allRowsSelected=!1)),o.totalSelectedDomains=c.length,o.vhostSelected=o.totalSelectedDomains>0,o.restrictedPhp.domainsSelected=p(),o.restrictedPhp.showAlert&&d()},o.rowClass=function(e){return e.impactedDomains.warn?"warning":e.impactedDomains.loading?"processing":void 0},o.showAllImpactedDomains=function(e){i.open({templateUrl:"impactedDomainsPopup.ptt",controller:"impactedDomainsPopup",resolve:{data:function(){return e}}})},o.clearAllSelections=function(e){e.preventDefault(),e.stopPropagation(),c=[],o.phpVhostList.forEach(function(e){e.rowSelected=!1}),o.checkdropdownOpen=!1,o.allRowsSelected=!1,o.totalSelectedDomains=0,o.vhostSelected=!1,o.restrictedPhp.showAlert=!1},o.hidePhpAlert=function(){o.restrictedPhp.showAlert=!1};var u=function(e){"undefined"!=typeof e&&(o.phpVersions=e,"undefined"!=typeof o.systemPhp&&""!==o.systemPhp&&o.phpVersions.push({version:"inherit",displayPhpVersion:"inherit"})),o.phpVersions.length>0?(o.selectedVersion=o.phpVersions[0],o.phpVersionsEmpty=!1):o.phpVersionsEmpty=!0},m=function(){u(),c=[],o.phpVhostList.forEach(function(e){e.rowSelected=!1}),o.allRowsSelected=!1,o.totalSelectedDomains=0,o.vhostSelected=!1};o.performApplyDomainPhp=function(){return n.clear(),o.restrictedPhp.showAlert&&(o.restrictedPhp.showAlert=!1),a.applyDomainSetting(o.selectedVersion.version,c).then(function(e){"undefined"!=typeof e&&(n.add({type:"success",message:t.maketext("Successfully applied [asis,PHP] version “[_1]” to the selected [numerate,_2,domain,domains].",o.selectedVersion.displayPhpVersion,c.length),closeable:!0,replace:!1,autoClose:1e4,group:"multiphpManager"}),o.selectPage())},function(e){if("undefined"!=typeof e.raw){var s=e.raw.errors;if(s.length>0){var a=[];e.data&&e.data.vhosts&&(a=e.data.vhosts),s.forEach(function(e){n.add({type:"danger",message:e,closeable:!0,replace:!1,group:"multiphpManager"})}),n.add({type:"success",message:t.maketext("Successfully applied [asis,PHP] version “[_1]” to [numerate,_2,a domain,some domains].",o.selectedVersion.displayPhpVersion,a.length),closeable:!0,replace:!1,autoClose:1e4,group:"multiphpManager"})}}else n.add({type:"danger",message:e.error,closeable:!0,replace:!1,group:"multiphpManager"})}).finally(function(){m()})},o.applyDomainPhp=function(){o.restrictedPhp.domainsSelected.length>0?d():o.performApplyDomainPhp()};var f=function(a){var i=a.items;o.meta.totalItems=a.totalItems;var r=i;if(o.meta.totalItems>s.min(o.meta.pageSizes)){var n=(o.meta.currentPage-1)*o.meta.pageSize;o.showPager=!0,o.meta.start=n+1,o.meta.limit=n+r.length}else o.showPager=!1,o.meta.start=0===r.length?0:1,o.meta.limit=r.length;var p=0;r.forEach(function(o){-1!==c.indexOf(o.vhost)?o.rowSelected=!0:(o.rowSelected=!1,p++),o.impactedDomains=e.copy(l),o.inherited=!1;var a=o.phpversion_source;if("undefined"!=typeof a){var i="",r="";"undefined"!=typeof a.domain?(i="domain",r=a.domain):"undefined"!=typeof a.system_default&&(i="system_default",r=t.maketext("System Default")),("domain"===i&&r!==o.vhost||"system_default"===i)&&(o.inherited=!0,o.inheritedInfo=t.maketext("This domain inherits its [asis,PHP] version “[output,em,_1]” from: [output,strong,_2]",o.displayPhpVersion,r))}o.isRestricted=!1,o.showInheritInfo=!1;var n=PAGE.versionListData.data.versions;s.some(n,["version",o.version])||(o.isRestricted=!0)}),o.restrictedPhp.showMore=6<o.restrictedPhp.domainsSelected.length,o.phpVhostList=r,o.allRowsSelected=r.length>0&&0===p},v=function(){return o.loadingVhostList=!0,a.fetchList(o.meta).then(function(e){f(e)},function(e){n.add({type:"danger",message:e,closeable:!0,replace:!1,group:"multiphpManager"})}).then(function(){o.loadingVhostList=!1})};o.selectPage=function(t){return t&&e.isNumber(t)&&(o.meta.currentPage=t),v()},o.$on("$viewContentLoaded",function(){if(n.clear(),PAGE.versionListData.data.versions=PAGE.versionListData.data.versions.map(function(e){return{version:e,displayPhpVersion:a.transformPhpFormat(e)}}),PAGE.vhostListData.status){o.loadingVhostList=!1;var e=a.prepareList(PAGE.vhostListData);f(e)}else n.add({type:"danger",message:PAGE.vhostListData.errors[0],closeable:!0,replace:!1,group:"multiphpManager"});PAGE.systemPHPData.status?o.systemPhp={version:PAGE.systemPHPData.data.version,displayPhpVersion:a.transformPhpFormat(PAGE.systemPHPData.data.version)}:n.add({type:"danger",message:PAGE.systemPHPData.errors[0],closeable:!0,replace:!1,group:"multiphpManager"}),PAGE.versionListData.status?u(PAGE.versionListData.data.versions):n.add({type:"danger",message:PAGE.versionListData.errors[0],closeable:!0,replace:!1,group:"multiphpManager"})})}]);return a}),define("app/index",["angular","jquery","lodash","cjt/core","cjt/modules","cjt/services/alertService","cjt/directives/alert","cjt/directives/alertList","ngRoute","uiBootstrap"],function(e,t,s,o){"use strict";return function(){e.module("App",["ngRoute","ui.bootstrap","cjt2.cpanel"]);var t=require(["cjt/bootstrap","cjt/views/applicationController","app/views/config"],function(t){var s=e.module("App");s.firstLoad={phpAccountList:!0},s.config(["$routeProvider","$locationProvider",function(e){e.when("/config/",{controller:"config",templateUrl:o.buildFullPath("multiphp_manager/views/config.html.tt"),reloadOnSearch:!1}),e.otherwise({redirectTo:"/config/"})}]),t("#content","App")});return t}});