define("app/services/configService",["angular","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi","cjt/services/APIService"],function(e,t,o){"use strict";var s;try{s=e.module("App")}catch(r){s=e.module("App",["cjt2.services.api"])}s.factory("configService",["$q","APIService",function(e,s){return{convertResponseToList:function(e){var t=[];if(e.status){for(var o=e.data,s=0,r=o.length;r>s;s++){var i=o[s];i.version&&(i.displayPhpVersion=this.transformPhpFormat(i.version)),t.push(i)}var n=e.meta,a=n.paginate.total_records||o.length,c=n.paginate.total_pages||1;return{items:t,totalItems:a,totalPages:c}}return{items:[],totalItems:0,totalPages:0}},applyDomainSetting:function(s,r){var i=e.defer(),n=this,a=new o.Class;return a.initialize("LangPHP","php_set_vhost_versions"),a.addArgument("version",s),"undefined"!=typeof r&&r.length>0&&r.forEach(function(e,t){a.addArgument("vhost-"+t,e)}),t.promise(a.getRunArguments()).done(function(e){if(e=e.parsedResponse,e.status){var t=n.convertResponseToList(e);i.resolve(t)}else i.reject(e)}),i.promise},fetchList:function(s){var r=e.defer(),i=this,n=new o.Class;return n.initialize("LangPHP","php_get_vhost_versions"),s&&(s.sortBy&&s.sortDirection&&n.addSorting(s.sortBy,s.sortDirection,s.sortType),s.currentPage&&n.addPaging(s.currentPage,s.pageSize||10),s.filterBy&&s.filterCompare&&s.filterValue&&n.addFilter(s.filterBy,s.filterCompare,s.filterValue)),t.promise(n.getRunArguments()).done(function(e){if(e=e.parsedResponse,e.status){var t=i.convertResponseToList(e);r.resolve(t)}else r.reject(e.error)}),r.promise},fetchImpactedDomains:function(e,t){var r=new o.Class,i=new s;r.initialize("LangPHP","php_get_impacted_domains"),r.addArgument(e,t);var n=i.deferred(r);return n.promise},prepareList:function(e){return this.convertResponseToList(e)},transformPhpFormat:function(e){var t=e||"",o=/^\D+-(php)(\d{2,3})$/i;if(o.test(e)){var s=e.match(o),r=s[2].replace(/(\d)$/,".$1");t="PHP "+r+" ("+e+")"}return t}}}])}),define("app/views/impactedDomainsPopup",["angular","lodash","cjt/util/locale","uiBootstrap"],function(e){var t=e.module("App"),o=t.controller("impactedDomainsPopup",["$scope","$uibModalInstance","data",function(e,t,o){e.modalData={};var s=o;e.modalData=s,e.closeModal=function(){t.close()}}]);return o}),define("app/views/config",["angular","cjt/util/locale","lodash","uiBootstrap","cjt/decorators/growlDecorator","app/services/configService","app/views/impactedDomainsPopup"],function(e,t,o){"use strict";var s=e.module("App"),r=s.controller("config",["$scope","configService","$uibModal","$timeout","alertService","growl","growlMessages",function(s,r,i,n,a,c,l){s.loadingVhostList=!1,s.phpVersionsEmpty=!0,s.selectedVersion={},s.phpVhostList=[],s.restrictedPhp={domainsSelected:[],showAlert:!1,alertInfo:"",showAllDomains:!1,showMore:!0},s.vhostSelected=!1;var p=[];s.totalSelectedDomains=0,s.checkdropdownOpen=!1,s.meta={sortReverse:!1,sortBy:"vhost",sortDirection:"asc",filterBy:"*",filterCompare:"contains",filterValue:"",maxPages:0,totalItems:s.phpVhostList.length,currentPage:1,pageSize:10,pageSizes:[10,20,50,100],start:0,limit:10};var d={loading:!1,warn:!1,show:!1,showMore:!1,text:""},h=function(){var e=[];return s.phpVhostList.forEach(function(t){t.rowSelected&&t.isRestricted&&e.push(t.vhost)}),e},m=function(){s.restrictedPhp.domainsSelected=h(),s.restrictedPhp.showMore=6<s.restrictedPhp.domainsSelected.length;var e=s.restrictedPhp.domainsSelected;if(e.length>0){s.restrictedPhp.showAlert=!0;var o=s.phpVersions.reduce(function(e,t){return"inherit"!==t.version&&e.push(t.displayPhpVersion),e},[]);s.restrictedPhp.alertInfo=t.maketext("The system administrator only allows this account to use the [asis,PHP] [numerate,_2,version,versions] [list_and,_1].",o,o.length)+" "+t.maketext("If you change the [asis,PHP] version for the following [numerate,_1,domain,domains], you cannot use this interface to change the [numerate,_1,domain,domains] back to use [numerate,_1,its,their] original version of [asis,PHP].",e.length)}else s.restrictedPhp.showAlert=!1};s.selectAllVhosts=function(){if(s.allRowsSelected)s.phpVhostList.forEach(function(e){e.rowSelected=!0,-1===p.indexOf(e.vhost)&&p.push(e.vhost)});else{var e=s.phpVhostList.map(function(e){return e.rowSelected=!1,e.vhost});p=o.difference(p,e),s.restrictedPhp.showAlert=!1}s.totalSelectedDomains=p.length,s.vhostSelected=s.totalSelectedDomains>0,s.restrictedPhp.domainsSelected=h(),s.restrictedPhp.showAlert&&m()};var u=function(e,s){s?(e.impactedDomains.loading=!0,r.fetchImpactedDomains("domain",e.vhost).then(function(s){var r=o.without(s.data.domains,e.vhost);s.status&&r.length>0&&(e.impactedDomains.show=e.impactedDomains.warn=e.rowSelected,e.impactedDomains.showMore=r.length>10,e.impactedDomains.text=t.maketext("A change to the “[output,strong,_1]” domain‘s PHP version affects the following domains:",e.vhost),e.impactedDomains.domains=o.sortBy(r))},function(e){c.error(e)}).finally(function(){e.impactedDomains.loading=!1})):e.impactedDomains.show=e.impactedDomains.warn=s};s.toggleRestrictedDomains=function(){s.restrictedPhp.showAllDomains=!s.restrictedPhp.showAllDomains},s.selectVhost=function(e){"undefined"!=typeof e&&(u(e,e.rowSelected),e.rowSelected?(p.push(e.vhost),s.allRowsSelected=s.phpVhostList.every(function(e){return e.rowSelected})):(p=p.filter(function(t){return t!==e.vhost}),s.allRowsSelected=!1)),s.totalSelectedDomains=p.length,s.vhostSelected=s.totalSelectedDomains>0,s.restrictedPhp.domainsSelected=h(),s.restrictedPhp.showAlert&&m()},s.rowClass=function(e){return e.impactedDomains.warn?"warning":e.impactedDomains.loading?"processing":void 0},s.showAllImpactedDomains=function(e){i.open({templateUrl:"impactedDomainsPopup.ptt",controller:"impactedDomainsPopup",resolve:{data:function(){return e}}})},s.clearAllSelections=function(e){e.preventDefault(),e.stopPropagation(),p=[],s.phpVhostList.forEach(function(e){e.rowSelected=!1}),s.checkdropdownOpen=!1,s.allRowsSelected=!1,s.totalSelectedDomains=0,s.vhostSelected=!1,s.restrictedPhp.showAlert=!1},s.hidePhpAlert=function(){s.restrictedPhp.showAlert=!1},s.performApplyDomainPhp=function(){return l.destroyAllMessages(),a.clear(),s.restrictedPhp.showAlert&&(s.restrictedPhp.showAlert=!1),r.applyDomainSetting(s.selectedVersion.version,p).then(function(e){"undefined"!=typeof e&&(c.success(t.maketext("Successfully applied [asis,PHP] version “[_1]” to the selected [numerate,_2,domain,domains].",s.selectedVersion.displayPhpVersion,p.length)),s.selectPage())},function(e){if("undefined"!=typeof e.raw){var o=e.raw.errors;if(o.length>0){var r=e.data.vhosts;o.forEach(function(e){a.add({type:"danger",message:e,id:"alertMessages",replace:!1,closeable:!0})});var i=t.maketext("For more information, check the error message at the top of the page.");if(r.length<=0){var n=t.maketext("Failed to apply [asis,PHP] version “[_1]” to the selected [numerate,_2,domain,domains].",s.selectedVersion.displayPhpVersion,o.length)+" "+i;return void c.error(n)}c.success(t.maketext("Successfully applied [asis,PHP] version “[_1]” to [numerate,_2,a domain,some domains].",s.selectedVersion.displayPhpVersion,r.length));var l=t.maketext("Failed to apply [asis,PHP] version “[_1]” to [numerate,_2,a domain,some domains].",s.selectedVersion.displayPhpVersion,o.length)+" "+i;c.error(l)}}else c.error(e.error)}).finally(function(){v()})},s.applyDomainPhp=function(){s.restrictedPhp.domainsSelected.length>0?m():s.performApplyDomainPhp()};var f=function(){return s.loadingVhostList=!0,r.fetchList(s.meta).then(function(e){P(e)},function(e){c.error(e)}).then(function(){s.loadingVhostList=!1})},v=function(){g(),p=[],s.phpVhostList.forEach(function(e){e.rowSelected=!1}),s.allRowsSelected=!1,s.totalSelectedDomains=0,s.vhostSelected=!1},g=function(e){"undefined"!=typeof e&&(s.phpVersions=e,"undefined"!=typeof s.systemPhp&&""!==s.systemPhp&&s.phpVersions.push({version:"inherit",displayPhpVersion:"inherit"})),s.phpVersions.length>0?(s.selectedVersion=s.phpVersions[0],s.phpVersionsEmpty=!1):s.phpVersionsEmpty=!0};s.selectPage=function(t){return t&&e.isNumber(t)&&(s.meta.currentPage=t),f()};var P=function(r){var i=r.items;s.meta.totalItems=r.totalItems;var n=i;if(s.meta.totalItems>o.min(s.meta.pageSizes)){var a=(s.meta.currentPage-1)*s.meta.pageSize;s.showPager=!0,s.meta.start=a+1,s.meta.limit=a+n.length}else s.showPager=!1,s.meta.start=0===n.length?0:1,s.meta.limit=n.length;var c=0;n.forEach(function(s){-1!==p.indexOf(s.vhost)?s.rowSelected=!0:(s.rowSelected=!1,c++),s.impactedDomains=e.copy(d),s.inherited=!1;var r=s.phpversion_source;if("undefined"!=typeof r){var i="",n="";"undefined"!=typeof r.domain?(i="domain",n=r.domain):"undefined"!=typeof r.system_default&&(i="system_default",n=t.maketext("System Default")),("domain"===i&&n!==s.vhost||"system_default"===i)&&(s.inherited=!0,s.inheritedInfo=t.maketext("This domain inherits its [asis,PHP] version “[output,em,_1]” from: [output,strong,_2]",s.displayPhpVersion,n))}s.isRestricted=!1,s.showInheritInfo=!1;var a=PAGE.versionListData.data.versions;o.some(a,["version",s.version])||(s.isRestricted=!0)}),s.restrictedPhp.showMore=6<s.restrictedPhp.domainsSelected.length,s.phpVhostList=n,s.allRowsSelected=n.length>0&&0===c};s.$on("$viewContentLoaded",function(){if(l.destroyAllMessages(),a.clear(),PAGE.versionListData.data.versions=PAGE.versionListData.data.versions.map(function(e){return{version:e,displayPhpVersion:r.transformPhpFormat(e)}}),PAGE.vhostListData.status){s.loadingVhostList=!1;var e=r.prepareList(PAGE.vhostListData);P(e)}else c.error(PAGE.vhostListData.errors[0]);PAGE.systemPHPData.status?s.systemPhp={version:PAGE.systemPHPData.data.version,displayPhpVersion:r.transformPhpFormat(PAGE.systemPHPData.data.version)}:c.error(PAGE.systemPHPData.errors[0]),PAGE.versionListData.status?g(PAGE.versionListData.data.versions):c.error(PAGE.versionListData.errors[0])})}]);return r}),define("app/index",["angular","jquery","lodash","cjt/core","cjt/modules","ngRoute","uiBootstrap"],function(e,t,o,s){"use strict";return function(){e.module("App",["ngRoute","ui.bootstrap","angular-growl","cjt2.cpanel"]);var t=require(["cjt/bootstrap","cjt/views/applicationController","app/views/config"],function(t){var o=e.module("App");o.firstLoad={phpAccountList:!0},o.config(["$routeProvider","$locationProvider",function(e){e.when("/config/",{controller:"config",templateUrl:s.buildFullPath("multiphp_manager/views/config.html.tt"),reloadOnSearch:!1}),e.otherwise({redirectTo:"/config/"})}]),t("#content","App")});return t}});