function MailingListItem(){var e=this;e.defaultValues={accesstype:"",advertised:0,archive_private:0,desthost:"",diskused:"",humandiskused:"00.00 KB",list:"",listadmin:"",listid:"",subscribe_policy:0}}function MailingListService(e,t){var i=this;if(i.lists=[],i.loading=!1,i.alertService=t,i.page=0,i.pageSize=10,i.maxPages=3,i.totalResults=0,i.filterValue="",i.totalPages=0,i.errors=[],i.request=null,i.meta={sort:{sortBy:"list",sortDirection:"asc",sortType:""}},i.meta.sort.sortString="list",i.addItem=function(e){var t=new MailingListItem;t.create(e),i.lists.push(t)},i.handleLoadSuccess=function(t){i.lists=[];for(var a=0;a<t.cpanel_data.length;a++)i.addItem(t.cpanel_data[a]);var r=t.cpanel_raw.metadata.paginate;"undefined"!=typeof r&&(i.totalPages=r.total_pages,i.totalResults=r.total_results),i.loading=!1,e.$apply()},i.handleLoadError=function(t){i.loading=!1,i.alertService.clear(),angular.forEach(t.cpanel_messages,function(e){i.alertService.add({message:e.content,type:e.level})}),e.$apply()},i.selectPage=function(){i.getLists()},i.selectPageSize=function(e){i.pageSize=e,i.getLists()},i.dataSorted=function(){i.meta.sort.sortString="asc"===i.meta.sort.sortDirection?i.meta.sort.sortBy:"!"+i.meta.sort.sortBy,i.getLists()},i.getLists=function(){YAHOO.util.Connect.isCallInProgress(i.request)&&(YAHOO.util.Connect.abort(i.request),i.request=null),i.errors=[];var e={module:"Email",version:"3",func:"list_lists",data:{domain:CPANEL.PAGE.domain},api_data:{sort:[],filter:[]},callback:{success:i.handleLoadSuccess,failure:i.handleLoadError}};"humandiskused"===i.meta.sort.sortBy?e.api_data.sort.push([("asc"===i.meta.sort.sortDirection?"":"!")+"diskused","numeric"]):""!==i.meta.sort.sortString&&e.api_data.sort.push(i.meta.sort.sortString),""!==i.filterValue&&e.api_data.filter.push(["*","contains",i.filterValue]),-1!==i.pageSize&&(e.api_data.paginate={start:(i.page-1)*i.pageSize,size:i.pageSize}),i.request=CPANEL.api(e),i.loading=!0},"initData"in window.PAGE){i.totalResults=Number(window.PAGE.initData.totalResults)||0,i.totalPages=Number(window.PAGE.initData.totalPages)||1,i.pageSize=Number(window.PAGE.initData.resultsPerPage)||i.pageSizes[0];for(var a=0;a<window.PAGE.initData.lists.length;a++)i.addItem(window.PAGE.initData.lists[a])}else i.getLists()}MailingListItem.prototype.create=function(e){angular.extend(this,this.defaultValues,e)},MailingListItem.prototype.getAttribute=function(e){return this[e]},MailingListItem.prototype.formatListAdmins=function(e){var t=this.getAttribute("listadmin"),i={maxItems:t.length,maxCols:t.length,separator:"\n"};e=angular.extend(i,e);for(var a,r=t.split(","),s=0;s<r.length;s++){var n=r[s].replace(/[\r\n]/gi,"").trim();if(n.length>e.maxCols&&(n=n.substr(0,e.maxCols-3)+"…"),r[s]=n,s===e.maxItems-1&&s+2<r.length){a=r.length-e.maxItems,r.splice(s+1);break}}var o;return o=a?LOCALE.maketext("[join,_1,_2][_1] … and [numf,_3] more",e.separator,r,a):r.join(e.separator)},define("app/services/mailingListsService",["angular","cjt/util/locale","cjt/services/alertService"],function(e){var t;try{t=e.module("App")}catch(i){t=e.module("App",[])}MailingListService.$inject=["$rootScope","alertService"],t.service("mailingListsService",MailingListService)}),define("app/controllers/mailingListsController",["angular","app/services/mailingListsService"],function(e){function t(e,t){var i=this;i.model=t,i.columnHeaders=[],i.addColumn=function(e,t){i.columnHeaders.push({key:e,name:t})},i.getHeaders=function(){return i.columnHeaders},i.getLists=function(){return i.model.lists},i.addColumn("list",LOCALE.maketext("List Name")),i.addColumn("humandiskused",LOCALE.maketext("Usage")),i.addColumn("accesstype",LOCALE.maketext("Access")),i.addColumn("listadmin",LOCALE.maketext("Admin")),i.addColumn("functions",LOCALE.maketext("Functions"))}var i;try{i=e.module("App")}catch(a){i=e.module("App",[])}t.$inject=["$scope","mailingListsService"],i.controller("mailingListsController",t)}),define("app/controllers/mainController",["angular","app/services/mailingListsService","cjt/directives/alertList","cjt/filters/qaSafeIDFilter","cjt/decorators/paginationDecorator"],function(e){function t(e,t,i){var a=this;a.model=t,a.spinner=i,e.totalItems=a.model.totalResults,e.currentPage=a.model.page,e.$watch(function(){return a.model.loading},function(){a.model.loading?a.spinner.start():a.spinner.stop()}),a.startSearch=function(){a.model.page=0,a.model.getLists()},a.clearSearch=function(){a.model.filterValue="",a.model.selectPage(0)},e.$watch(function(){return a.model.pageSize},function(e,t){e!==t&&a.model.getLists()}),e.$watch(function(){return a.model.filterValue},function(e,t){""!==e?a.startSearch():e!==t&&a.clearSearch()})}var i;try{i=e.module("App")}catch(a){i=e.module("App",[])}t.$inject=["$scope","mailingListsService","spinnerAPI"],i.controller("mainController",t)}),function(e){"use strict";function t(e,t,i){var a=i.dialog,r=c.dom.get_data_from_form(a.form,{include_unchecked_checkboxes:0});r.list=i.list,c.api({version:3,module:"Email",func:"set_list_privacy_options",data:r,callback:c.ajax.build_page_callback(function(){i.onSuccess.call(),a.destroy()},{on_error:a.destroy.bind(a)})})}function i(){var e=this,t=d.getAncestorByTagName(e,"form"),i=c.dom.get_data_from_form(t);for(var r in _)if("checkbox"===t[r].type)t[r].checked=_[r];else{var s=_[r];u.lang.isArray(s)||(s=[s]),-1===s.indexOf(i[r])&&c.dom.set_form_el_value(t[r],s[0])}a("private")}function a(e){d.get("form_access_type").innerHTML=m.translated_access_type[e]}function r(e,t){var i,r="private",s=c.dom.get_data_from_form(t);for(var n in _)if(_.hasOwnProperty(n)){i="checkbox"===t[n].type?!!s[n]:s[n];var o=_[n];if(u.lang.isArray(o)?-1===o.indexOf(i)&&(r="public"):i!==o&&(r="public"),"public"===r)break}a(r)}function s(e,t){setTimeout(function(){r(e,t)},1)}function n(e,a,n){o||(o=g.compile(d.get("change_list_privacy_template").text.trim()));var u=new c.ajax.Common_Dialog(null,{close:!0,show_status:!0,status_html:l.maketext("Saving …")});u.setHeader(c.widgets.Dialog.applyDialogHeader(l.maketext("Edit Privacy Options: “[_1]”",e.list.html_encode())));var m=e,f=String(m.subscribe_policy);u.form.innerHTML=o({advertised:"1"===String(m.advertised),archive_private:"1"===String(m.archive_private),subscribe_policy_is_1:"1"===f,subscribe_policy_is_2:"2"===f,subscribe_policy_is_3:"3"===f}),u.submitEvent.subscribe(t,{list:e.list.html_encode(),dialog:u,onSuccess:n}),u.show_from_source(a),r(null,u.form),p.on(u.form,"change",r,u.form),p.on(u.form,"reset",s,u.form);var v=c.Y(u.form).one(".set-private-values");p.on(v,"click",i)}var o,l=e.LOCALE,c=e.CPANEL,u=e.YAHOO,d=u.util.Dom,p=u.util.Event,m=e.CPANEL.PAGE,g=e.Handlebars,f={};if(m.lists&&m.lists.length)for(var v=m.lists.length-1;v>=0;v--)f[m.lists[v].list]=m.lists[v];var _={advertised:!1,archive_private:!0,subscribe_policy:["3","2"]};u.lang.augmentObject(e,{privacy_opts_popup:n}),m.notice&&(m.noticeHandle=new c.widgets.Page_Notice(m.notice))}(window),define("app/lists",["angular","cjt/modules"],function(e){"use strict";e.module("App",["ui.bootstrap","cjt2.cpanel"]);var t=require(["cjt/directives/toggleSortDirective","cjt/directives/spinnerDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective","app/services/mailingListsService","app/controllers/mailingListsController","app/controllers/mainController","uiBootstrap"],function(){function t(e){var i=this;t.prototype.closed=function(){e.getLists()},t.prototype.open=function(e,t){window.privacy_opts_popup(e,t.currentTarget,i.closed)}}var i=e.module("App");i.filter("escape",function(){return window.escape}),t.$inject=["mailingListsService"],i.controller("PrivacyWindowController",t),i.init=function(){var t=e.element("#content");return null!==t[0]&&e.bootstrap(t[0],["App"]),i},i.init()});return t});