(function(window){"use strict";var LOCALE=window.LOCALE,CPANEL=window.CPANEL,YAHOO=window.YAHOO,DOM=YAHOO.util.Dom,EVENT=YAHOO.util.Event,PAGE=window.CPANEL.PAGE;var Handlebars=window.Handlebars;var privacy_opts_maker;var record_by_email={};if(PAGE.lists&&PAGE.lists.length){for(var l=PAGE.lists.length-1;l>=0;l--){record_by_email[PAGE.lists[l].list]=PAGE.lists[l]}}var PRIVATE_PRIVACY_OPTIONS={advertised:false,archive_private:true,subscribe_policy:["3","2"]};function _privacy_opts_submit_handler(type,args,obj){var dialog=obj.dialog;var params=CPANEL.dom.get_data_from_form(dialog.form,{include_unchecked_checkboxes:0});params.list=obj.list;CPANEL.api({version:3,module:"Email",func:"set_list_privacy_options",data:params,callback:CPANEL.ajax.build_page_callback(function(){obj.onSuccess.call();dialog.destroy()},{on_error:dialog.destroy.bind(dialog)})})}function _set_private_values_in_form(){var clicked_el=this;var form=DOM.getAncestorByTagName(clicked_el,"form");var form_data=CPANEL.dom.get_data_from_form(form);for(var key in PRIVATE_PRIVACY_OPTIONS){if(form[key].type==="checkbox"){form[key].checked=PRIVATE_PRIVACY_OPTIONS[key]}else{var acceptable=PRIVATE_PRIVACY_OPTIONS[key];if(!YAHOO.lang.isArray(acceptable)){acceptable=[acceptable]}if(acceptable.indexOf(form_data[key])===-1){CPANEL.dom.set_form_el_value(form[key],acceptable[0])}}}_update_access_type_text_in_form("private")}function _update_access_type_text_in_form(new_type){DOM.get("form_access_type").innerHTML=PAGE.translated_access_type[new_type]}function _reevaluate_access_type_in_form(evt,the_form){var type="private";var to_compare;var form_data=CPANEL.dom.get_data_from_form(the_form);for(var key in PRIVATE_PRIVACY_OPTIONS){if(PRIVATE_PRIVACY_OPTIONS.hasOwnProperty(key)){if(the_form[key].type==="checkbox"){to_compare=!!form_data[key]}else{to_compare=form_data[key]}var acceptable_for_private=PRIVATE_PRIVACY_OPTIONS[key];if(YAHOO.lang.isArray(acceptable_for_private)){if(acceptable_for_private.indexOf(to_compare)===-1){type="public"}}else if(to_compare!==acceptable_for_private){type="public"}if(type==="public"){break}}}_update_access_type_text_in_form(type)}function _delayed_reevaluate_access_type_in_form(evt,the_form){setTimeout(function(){_reevaluate_access_type_in_form(evt,the_form)},1)}function privacy_opts_popup(list,clicked_obj,successFunction){if(!privacy_opts_maker){privacy_opts_maker=Handlebars.compile(DOM.get("change_list_privacy_template").text.trim())}var dialog=new CPANEL.ajax.Common_Dialog(null,{close:true,show_status:true,status_html:LOCALE.maketext("Saving …")});dialog.setHeader(CPANEL.widgets.Dialog.applyDialogHeader(LOCALE.maketext("Edit Privacy Options: “[_1]”",list.list.html_encode())));var list_record=list;var subscribe_policy=String(list_record.subscribe_policy);dialog.form.innerHTML=privacy_opts_maker({advertised:String(list_record.advertised)==="1",archive_private:String(list_record.archive_private)==="1",subscribe_policy_is_1:subscribe_policy==="1",subscribe_policy_is_2:subscribe_policy==="2",subscribe_policy_is_3:subscribe_policy==="3"});dialog.submitEvent.subscribe(_privacy_opts_submit_handler,{list:list.list.html_encode(),dialog:dialog,onSuccess:successFunction});dialog.show_from_source(clicked_obj);_reevaluate_access_type_in_form(null,dialog.form);EVENT.on(dialog.form,"change",_reevaluate_access_type_in_form,dialog.form);EVENT.on(dialog.form,"reset",_delayed_reevaluate_access_type_in_form,dialog.form);var private_values_el=CPANEL.Y(dialog.form).one(".set-private-values");EVENT.on(private_values_el,"click",_set_private_values_in_form)}YAHOO.lang.augmentObject(window,{privacy_opts_popup:privacy_opts_popup});if(PAGE.notice){PAGE.noticeHandle=new CPANEL.widgets.Page_Notice(PAGE.notice)}})(window);define(["angular","cjt/modules"],function(angular){"use strict";angular.module("App",["ui.bootstrap","cjt2.cpanel"]);var app=require(["cjt/directives/toggleSortDirective","cjt/directives/spinnerDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective","app/services/mailingListsService","app/controllers/mailingListsController","app/controllers/mainController","uiBootstrap"],function(){var app=angular.module("App");app.filter("escape",function(){return window.escape});function PrivacyWindowController(mailingListsService){var _self=this;PrivacyWindowController.prototype.closed=function(){mailingListsService.getLists()};PrivacyWindowController.prototype.open=function(list,target){window.privacy_opts_popup(list,target.currentTarget,_self.closed)}}PrivacyWindowController.$inject=["mailingListsService"];app.controller("PrivacyWindowController",PrivacyWindowController);app.init=function(){var appContent=angular.element("#content");if(appContent[0]!==null){angular.bootstrap(appContent[0],["App"])}return app};app.init()});return app});