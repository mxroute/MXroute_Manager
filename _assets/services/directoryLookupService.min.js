define(["angular","lodash","cjt/core","cjt/util/locale","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi","cjt/util/parse"],function(angular,_,CJT,LOCALE,API,APIREQUEST,APIDRIVER,PARSER){"use strict";var app=angular.module("cpanel.services.directoryLookup",[]);var lastRequestJQXHR=null;app.factory("directoryLookupService",["$q","APIService",function($q,APIService){var DirectoryLookupService=function(){};DirectoryLookupService.prototype=new APIService;angular.extend(DirectoryLookupService.prototype,{complete:function(match){if(lastRequestJQXHR){lastRequestJQXHR.abort()}var apiCall=new APIREQUEST.Class;apiCall.initialize("Fileman","autocompletedir");apiCall.addArgument("path",match);apiCall.addArgument("dirsonly",true);apiCall.addArgument("skipreserved",true);apiCall.addArgument("html",0);if("/"===match.charAt(match.length-1)){apiCall.addArgument("list_all",true)}var deferred=this.deferred(apiCall,{transformAPISuccess:function(response){var flattenedResponse=[];for(var i=0,l=response.data.length;i<l;i++){flattenedResponse.push(response.data[i].file)}return flattenedResponse}});return deferred.promise},sendRequest:function(apiCall,handlers,deferred){apiCall=new APIService.AngularAPICall(apiCall,handlers,deferred);lastRequestJQXHR=apiCall.jqXHR;return apiCall.deferred}});return new DirectoryLookupService}])});