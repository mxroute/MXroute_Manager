define("app/services/page_data_service",["angular"],function(e){var t=e.module("cpanel.zoneEditor");t.factory("pageDataService",[function(){return{prepareDefaultInfo:function(e){e.has_adv_feature=e.has_adv_feature||!1,e.has_simple_feature=e.has_simple_feature||!1,e.has_dnssec_feature=e.has_dnssec_feature||!1,e.has_mx_feature=e.has_mx_feature||!1,e.domains=e.domains||[];var t=[10,20,50,100];return"number"!=typeof e.zones_per_page&&(e.zones_per_page=parseInt(e.zones_per_page,10)),e.zones_per_page&&-1!==t.indexOf(e.zones_per_page)||(e.zones_per_page=50),"number"!=typeof e.domains_per_page&&(e.domains_per_page=parseInt(e.domains_per_page,10)),e.domains_per_page&&-1!==t.indexOf(e.domains_per_page)||(e.domains_per_page=50),e}}}])}),define("app/services/domains",["angular","jquery","cjt/util/locale","cjt/io/api","cjt/io/api2-request","cjt/io/api2","cjt/util/httpStatus","cjt/core"],function(e,t,r,a,n,i,o,s){var d=e.module("cpanel.zoneEditor"),c=d.factory("Domains",["$q","defaultInfo",function(e,t){var i={};return i.domains=[],i.fetch=function(t){if(0===i.domains.length||t){var d=new n.Class;return d.initialize("DomainLookup","getbasedomains"),e.when(a.promise(d.getRunArguments())).then(function(t){return t=t.parsedResponse,t.status?(i.domains=t.data,i.domains):e.reject(t.error)}).catch(function(t){var a=r.maketext("The API request failed with the following error: [_1] - [_2].",t.status,o.convertHttpStatusToReadable(t.status));return(401===t.status||403===t.status)&&(a+=" "+r.maketext("Your session may have expired or you logged out of the system. [output,url,_1,Login] again to continue.",s.getLoginPath())),e.reject(a)})}return e.when(i.domains)},i.init=function(){i.domains=t.domains},i.init(),i}]);return c}),define("app/services/zones",["angular","lodash","cjt/util/locale","cjt/io/api","cjt/io/api2-request","cjt/io/uapi-request","cjt/util/httpStatus","cjt/core","cjt/io/api2","cjt/io/uapi"],function(e,t,r,a,n,i,o,s){var d=e.module("cpanel.zoneEditor"),c=d.factory("Zones",["$q",function(d){function c(e,t){e.addArgument("name",t.name),e.addArgument("type",t.type),e.addArgument("class","IN"),t.ttl&&e.addArgument("ttl",t.ttl),t.line&&e.addArgument("line",t.line),"A"===t.type||"AAAA"===t.type?e.addArgument("address",t.address):"CNAME"===t.type?e.addArgument("cname",t.cname):"MX"===t.type?(e.addArgument("exchange",t.exchanger),e.addArgument("preference",t.preference)):"SRV"===t.type?(e.addArgument("priority",t.priority),e.addArgument("weight",t.weight),e.addArgument("port",t.port),e.addArgument("target",t.target)):"TXT"===t.type?e.addArgument("txtdata",t.txtdata):"CAA"===t.type&&(e.addArgument("tag",t.tag),e.addArgument("flag",t.flag),e.addArgument("value",t.value))}function l(e,t){var r=new n.Class;return r.initialize("ZoneEdit","add_zone_record"),r.addArgument("domain",e),c(r,t),d.when(a.promise(r.getRunArguments())).then(function(e){return e=e.parsedResponse,e.status?(e.data[0]&&e.data[0].result&&(g.zone_serial_number=e.data[0].result.newserial),!0):d.reject(e)}).catch(function(e){return d.reject(e.status?g.request_failure_message(e.status):e.error)})}function u(e,t){var r=new n.Class;return r.initialize("ZoneEdit","edit_zone_record"),r.addArgument("domain",e),c(r,t),d.when(a.promise(r.getRunArguments())).then(function(e){return e=e.parsedResponse,e.status?(e.data[0]&&e.data[0].result&&(g.zone_serial_number=e.data[0].result.newserial),!0):d.reject(e)}).catch(function(e){return d.reject(e.status?g.request_failure_message(e.status):e.error)})}function m(e,t){var r=new i.Class;r.initialize("Email","add_mx");var n="";return n=t.hasOwnProperty("name")&&t.name!==e?t.name.slice(0,-1):e,r.addArgument("domain",n),r.addArgument("exchanger",t.exchanger),r.addArgument("priority",t.priority),d.when(a.promise(r.getRunArguments())).then(function(e){return e=e.parsedResponse,e.status?e.data:d.reject(e)}).catch(function(e){return d.reject(e.status?g.request_failure_message(e.status):e.error)})}function _(e,t){var r=new n.Class;return r.initialize("ZoneEdit","remove_zone_record"),r.addArgument("domain",e),r.addArgument("line",t),d.when(a.promise(r.getRunArguments())).then(function(e){return e=e.parsedResponse,e.status?void(g.zone_serial_number=e.data[0].serialnum):d.reject(e)}).catch(function(e){return d.reject(e.status?g.request_failure_message(e.status):e.error)})}function f(e,t){var r=new i.Class,n="";return n=t.name!==e?t.name.slice(0,-1):e,r.initialize("Email","delete_mx"),r.addArgument("domain",n),r.addArgument("exchanger",t.exchange),r.addArgument("priority",t.preference),d.when(a.promise(r.getRunArguments())).then(function(e){return e=e.parsedResponse,e.status?void(g.zone_serial_number=""):d.reject(e)}).catch(function(e){return d.reject(e.status?g.request_failure_message(e.status):e.error)})}function p(e,t){for(var r={},a=0,n=e.length;n>a;a++)e[a][t]&&e[a][t].length>0&&(r[e[a][t]]=!0);return r}var g={};return g.zones=[],g.zone_serial_number="",g.generated_domains=[],g.add_record=function(e,t){return"MX"===t.type?m(e,t):l(e,t)},g.update_record=function(e,t){return u(e,t)},g.fetch=function(e,t){if(0===g.zones.length||t){var r=new n.Class;return r.initialize("ZoneEdit","fetchzone"),r.addArgument("domain",e),r.addArgument("type","$TTL|A|AAAA|CAA|CNAME|MX|SRV|TXT"),d.when(a.promise(r.getRunArguments())).then(function(e){return e=e.parsedResponse,e.status?(g.zones=e.data[0].record,g.zone_serial_number=e.data[0].serialnum,g.zones):d.reject(e)}).catch(function(e){return d.reject(e.status?g.request_failure_message(e.status):e.error)})}return d.when(g.zones)},g.remove_zone_record=function(e,t){return"MX"===t.type?f(e,t):_(e,t.line)},g.reset_zone=function(e){var t=new n.Class;return t.initialize("ZoneEdit","resetzone"),t.addArgument("domain",e),d.when(a.promise(t.getRunArguments())).then(function(e){return e=e.parsedResponse,e.status?!0:d.reject(e)}).catch(function(e){return d.reject(e.status?g.request_failure_message(e.status):e.error)})},g.fetch_generated_domains=function(e,r){if(0===t.keys(g.generated_domains).length||r){var i=new n.Class;return i.initialize("ZoneEdit","fetch_cpanel_generated_domains"),i.addArgument("domain",e),d.when(a.promise(i.getRunArguments())).then(function(e){return e=e.parsedResponse,g.generated_domains=p(e.data,"domain"),g.generated_domains}).catch(function(e){return d.reject(g.request_failure_message(e.status))})}return d.when(g.generated_domains)},g.format_zone_name=function(t,r){var a=r;if(!e.isDefined(a)||null===a||""===a)return"";if("."!==r.charAt(r.length-1)&&(a+="."),!e.isDefined(t)||null===t||""===t)return a;var n=t+".",i=a.slice(-1*n.length);return i.toLowerCase()!==n.toLowerCase()&&(a+=n),a},g.request_failure_message=function(e){var t=r.maketext("The API request failed with the following error: [_1] - [_2].",e,o.convertHttpStatusToReadable(e));return(401===e||403===e)&&(t+=" "+r.maketext("Your session may have expired or you logged out of the system. [output,url,_1,Login] again to continue.",s.getLoginPath())),t},g}]);return c}),define("app/services/dnssec",["angular","jquery","lodash","cjt/util/locale","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi"],function(e,t,r,a,n,i){var o=e.module("cpanel.zoneEditor"),s=o.factory("DNSSEC",["$q","defaultInfo",function(e){function t(t,r){var a=new i.Class;return r?a.initialize("DNSSEC","enable_dnssec"):a.initialize("DNSSEC","disable_dnssec"),a.addArgument("domain",t),e.when(n.promise(a.getRunArguments())).then(function(r){return r=r.parsedResponse,r.status?r.meta.DNSSEC&&r.meta.DNSSEC.failed?e.reject(r.meta.DNSSEC.failed[t]):!0:e.reject(r.error)})}var a={};return a.enable=function(e){return t(e,!0)},a.disable=function(e){return t(e,!1)},a.fetch=function(t){var a=new i.Class;return a.initialize("DNSSEC","fetch_ds_records"),a.addArgument("domain",t),e.when(n.promise(a.getRunArguments())).then(function(a){return a=a.parsedResponse,a.status?a.data[t].keys?r.orderBy(a.data[t].keys,"active").reverse():[]:e.reject(a.error)})},a}]);return s}),define("app/services/features",["angular"],function(e){var t=e.module("cpanel.zoneEditor"),r=t.factory("Features",["defaultInfo",function(e){var t={};return t.dnssec=!1,t.mx=!1,t.simple=!1,t.advanced=!1,t.init=function(){t.dnssec=e.has_dnssec_feature,t.mx=e.has_mx_feature,t.simple=e.has_simple_feature,t.advanced=e.has_adv_feature},t.init(),t}]);return r}),define("app/models/dynamic_table",["lodash","cjt/util/locale"],function(e,t){function r(){this.items=[],this.filteredList=this.items,this.selected=[],this.allDisplayedRowsSelected=!1,this.filterFunction=void 0,this.quickFilterFunction=void 0,this.meta={sortBy:"",sortDirection:"asc",maxPages:0,totalItems:this.items.length,pageNumber:1,pageSize:10,pageSizes:[10,20,50,100],start:0,limit:0,filterValue:"",quickFilterValue:""}}return r.prototype.loadData=function(t){if(!e.isArray(t))throw"Developer Exception: loadData requires an array";this.items=t;for(var r=0,a=this.items.length;a>r;r++){if(!e.isObject(this.items[r]))throw"Developer Exception: loadData requires an array of objects";this.items[r]._id=r,this.items[r].selected&&this.selected.push(this.items[r]._id)}},r.prototype.setFilterFunction=function(t){if(!e.isFunction(t))throw"Developer Error: setFilterFunction requires a function";this.filterFunction=t},r.prototype.setQuickFilterFunction=function(t){if(!e.isFunction(t))throw"Developer Error: setQuickFilterFunction requires a function";this.quickFilterFunction=t},r.prototype.setSort=function(t,r){e.isUndefined(t)||(this.meta.sortBy=t),e.isUndefined(r)||(this.meta.sortDirection=r)},r.prototype.getMetadata=function(){return this.meta},r.prototype.getList=function(){return this.filteredList},r.prototype.getSelectedList=function(){return this.items.filter(function(e){return e.selected})},r.prototype.areAllDisplayedRowsSelected=function(){return this.allDisplayedRowsSelected},r.prototype.getTotalRowsSelected=function(){return this.selected.length},r.prototype.selectAllDisplayed=function(t){if(t)for(var r=0,a=this.filteredList.length;a>r;r++){var n=this.filteredList[r];n.selected=!0,-1===this.selected.indexOf(n._id)&&this.selected.push(n._id)}else{var i=this.filteredList.map(function(e){return e.selected=!1,e._id});this.selected=e.difference(this.selected,i)}this.allDisplayedRowsSelected=t},r.prototype.selectItem=function(t){if(!e.isUndefined(t))if(t.selected){if(-1!==this.selected.indexOf(t._id))return;this.selected.push(t._id),this.allDisplayedRowsSelected=this.filteredList.every(function(e){return e.selected})}else this.selected=this.selected.filter(function(e){return e!==t._id}),this.allDisplayedRowsSelected=!1},r.prototype.clearAllSelections=function(){this.selected=[];for(var e=0,t=this.items.length;t>e;e++){var r=this.items[e];r.selected=!1}this.allDisplayedRowsSelected=!1},r.prototype.clear=function(){this.items=[],this.selected=[],this.allDisplayedRowsSelected=!1,this.filteredList=this.populate()},r.prototype.populate=function(){var t=[],r=this;if(t=null!==this.meta.filterValue&&void 0!==this.meta.filterValue&&""!==this.meta.filterValue&&e.isFunction(this.filterFunction)?this.items.filter(function(e){return r.filterFunction(e,r.meta.filterValue)}):this.items,null!==this.meta.quickFilterValue&&void 0!==this.meta.quickFilterValue&&""!==this.meta.quickFilterValue&&e.isFunction(this.quickFilterFunction)&&(t=t.filter(function(e){return r.quickFilterFunction(e,r.meta.quickFilterValue)})),""!==this.meta.sortDirection&&""!==this.meta.sortBy&&(t=e.orderBy(t,[this.meta.sortBy],[this.meta.sortDirection])),this.meta.totalItems=t.length,this.meta.totalItems>e.min(this.meta.pageSizes)){var a=(this.meta.pageNumber-1)*this.meta.pageSize,n=this.meta.pageNumber*this.meta.pageSize;t=e.slice(t,a,n),this.meta.start=a+1,this.meta.limit=a+t.length}else this.meta.start=0===t.length?0:1,this.meta.limit=t.length;for(var i=0,o=0,s=t.length;s>o;o++){var d=t[o];-1!==this.selected.indexOf(d._id)?d.selected=!0:(d.selected=!1,i++)}return this.filteredList=t,this.allDisplayedRowsSelected=t.length>0&&0===i,t},r.prototype.paginationMessage=function(){return t.maketext("Displaying [numf,_1] to [numf,_2] out of [quant,_3,item,items]",this.meta.start,this.meta.limit,this.meta.totalItems)},r}),define("app/directives/convert_to_full_record_name",["angular","cjt/util/locale","cjt/core"],function(e){var t=e.module("cpanel.zoneEditor");t.directive("convertToFullRecordName",["Zones",function(e){return{restrict:"A",require:"ngModel",scope:{domain:"="},link:function(t,r,a,n){function i(r){var a=e.format_zone_name(t.domain,n.$viewValue);a!==n.$viewValue&&(n.$setViewValue(a,r),n.$render())}n&&(r.on("blur",function(){i("blur")}),r.on("keydown",function(e){13===e.keyCode&&i("keydown")}))}}}])}),define("app/views/domain_selection",["angular","lodash","cjt/util/locale","app/models/dynamic_table","cjt/decorators/growlDecorator","cjt/directives/actionButtonDirective","cjt/decorators/paginationDecorator","cjt/directives/toggleSortDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective","cjt/directives/validationContainerDirective","cjt/directives/validationItemDirective","cjt/filters/qaSafeIDFilter","cjt/validator/ip-validators","cjt/validator/domain-validators","cjt/services/viewNavigationApi","cjt/services/cpanel/nvDataService","app/directives/convert_to_full_record_name","uiBootstrap"],function(e,t,r,a){"use strict";var n=e.module("cpanel.zoneEditor"),i=n.controller("ListDomainsController",["$q","$location","$routeParams","growl","Domains","Zones","$uibModal","viewNavigationApi","Features","defaultInfo","nvDataService",function(e,n,i,o,s,d,c,l,u,m,_){function f(e,t){return-1!==e.domain.indexOf(t)}function p(e){return void 0===e&&(e=!1),g.ui.is_loading=!0,s.fetch(e).then(function(e){g.domains=e,h.loadData(g.domains),g.render()}).catch(function(e){g.loading_error=!0,g.loading_error_message=e}).finally(function(){g.ui.is_loading=!1})}var g=this;g.ui={},g.ui.is_loading=!1,g.domains=[],g.Features=u,g.modal={},g.modal.instance=null,g.modal.title="",g.modal.name_label=r.maketext("Name"),g.modal.cname_label="CNAME",g.modal.address_label=r.maketext("Address"),g.modal.exchanger_label=r.maketext("Destination"),g.modal.exchanger_placeholder=r.maketext("Fully qualified domain name"),g.modal.priority_label=r.maketext("Priority"),g.modal.priority_placeholder=r.maketext("Integer"),g.modal.create_a_record=r.maketext("Add an [asis,A] Record"),g.modal.create_cname_record=r.maketext("Add a [asis,CNAME] Record"),g.modal.create_mx_record=r.maketext("Add an [asis,MX] Record"),g.modal.cancel_label=r.maketext("Cancel"),g.modal.required_msg=r.maketext("This field is required."),g.loading_error=!1,g.loading_error_message="";var h=new a;h.setSort("domain"),h.setFilterFunction(f),g.meta=h.getMetadata(),g.filteredList=h.getList(),g.paginationMessage=h.paginationMessage,g.meta.pageSize=m.domains_per_page,g.render=function(){g.filteredList=h.populate()},g.sortList=function(){g.render()},g.selectPage=function(){g.render()},g.selectPageSize=function(){g.render(),m.domains_per_page!==g.meta.pageSize&&_.setObject({domains_per_page:g.meta.pageSize}).then(function(){m.domains_per_page=g.meta.pageSize}).catch(function(e){o.error(e)})},g.searchList=function(){g.render()},g.refresh=function(){return p(!0)},g.aRecordModalController=function(e,a){var n=this;n.domain=a,n.modal_header=r.maketext("Add an [asis,A] Record for “[_1]”",a),n.name_label=g.modal.name_label,n.address_label=g.modal.address_label,n.submit_label=g.modal.create_a_record,n.cancel_label=g.modal.cancel_label,n.required_msg=g.modal.required_msg,n.zone_name_placeholder=d.format_zone_name(a,"example"),n.resource={name:"",address:"",type:"A"},n.cancel=function(){e.dismiss("cancel")},n.save=function(){return d.add_record(n.domain,n.resource).then(function(){o.success(r.maketext("You successfully added the following [asis,_1] record for “[_2]”: [_3]","A",n.domain,t.escape(n.resource.name)))},function(e){o.error(e)}).finally(function(){e.close({$value:n.resource})})}},g.aRecordModalController.$inject=["$uibModalInstance","domain"],g.cnameRecordModalController=function(e,a){var n=this;n.domain=a,n.modal_header=r.maketext("Add a [asis,CNAME] Record for “[_1]”",a),n.name_label=g.modal.name_label,n.cname_label=g.modal.cname_label,n.submit_label=g.modal.create_cname_record,n.cancel_label=g.modal.cancel_label,n.required_msg=g.modal.required_msg,n.zone_name_placeholder=d.format_zone_name(a,"example"),n.resource={name:"",cname:"",type:"CNAME"},n.cancel=function(){e.dismiss("cancel")},n.save=function(){return d.add_record(n.domain,n.resource).then(function(){o.success(r.maketext("You successfully added the following [asis,_1] record for “[_2]”: [_3]","CNAME",n.domain,t.escape(n.resource.name)))},function(e){o.error(e)}).finally(function(){e.close({$value:n.resource})})}},g.cnameRecordModalController.$inject=["$uibModalInstance","domain"],g.mxRecordModalController=function(e,t){var a=this;a.domain=t,a.modal_header=r.maketext("Add an [asis,MX] Record for “[_1]”",t),a.name_label=g.modal.name_label,a.exchanger_label=g.modal.exchanger_label,a.exchanger_placeholder=g.modal.exchanger_placeholder,a.priority_label=g.modal.priority_label,a.priority_placeholder=g.modal.priority_placeholder,a.submit_label=g.modal.create_mx_record,a.cancel_label=g.modal.cancel_label,a.required_msg=g.modal.required_msg,a.resource={type:"MX",exchanger:"",priority:""},a.cancel=function(){e.dismiss("cancel")},a.save=function(){return d.add_record(a.domain,a.resource).then(function(){o.success(r.maketext("You successfully added the [asis,_1] record for “[_2]”.","MX",a.domain))},function(e){o.error(e)}).finally(function(){e.close({$value:a.resource})})}},g.mxRecordModalController.$inject=["$uibModalInstance","domain"],g.create_a_record=function(e){g.modal.instance=c.open({templateUrl:"views/a_record_form.html",controller:g.aRecordModalController,controllerAs:"ar",resolve:{domain:function(){return e.domain}}})},g.create_cname_record=function(e){g.modal.instance=c.open({templateUrl:"views/cname_record_form.html",controller:g.cnameRecordModalController,controllerAs:"cr",resolve:{domain:function(){return e.domain}}})},g.create_mx_record=function(e){g.modal.instance=c.open({templateUrl:"views/mx_record_form.html",controller:g.mxRecordModalController,controllerAs:"mxr",resolve:{domain:function(){return e.domain}}})},g.goToView=function(e,t){l.loadView("/"+e+"/"+t)},g.init=function(){p()},g.init()}]);return i}),define("app/models/dmarc_record",[],function(){function e(){this.resetProperties()}var t=/^[vV]\s*=\s*DMARC1\s*;\s*[pP]\s*=/,r=/^[a-z][a-z0-9+.-]*:[^,!;]+(?:![0-9]+[kmgt]?)?$/i,a=function(e){!/^[a-z][a-z0-9+.-]*:/i.test(e)&&/@[^\s@]{2,255}$/.test(e)&&(e="mailto:"+encodeURI(e).replace(/[\/?#&;=]/g,function(e){return"%"+e.charCodeAt(0).toString(16)}));var t=/[,!;]/g;if(t.test(e)){var r="";e=e.replace(/![0-9]+[kmgt]?$/i,function(e){return r=e,""}),e=e.replace(t,function(e){return"%"+e.charCodeAt(0).toString(16)}),e+=r}return e},n=function(e){return void 0!==e&&null!==e&&("string"==typeof e?e.length>0:!0)};e.prototype.resetProperties=function(){this.p="none",this.sp="none",this.adkim="r",this.aspf="r",this.pct=100,this.fo="0",this.rf="afrf",this.ri=86400,this.rua="",this.ruf=""},e.prototype.validators={p:{values:["none","quarantine","reject"],defValue:"none"},sp:{values:["none","quarantine","reject"]},adkim:{values:["r","s"],defValue:"r"},aspf:{values:["r","s"],defValue:"r"},rf:{multi:":",values:["afrf","iodef"],defValue:"afrf"},fo:{multi:":",values:["0","1","s","d"],defValue:"0"},pct:{pattern:/^[0-9]{1,2}$|^100$/,defValue:100},ri:{pattern:/^\d+$/,defValue:86400},rua:{multi:",",scrub:a,pattern:r,defValue:""},ruf:{multi:",",scrub:a,pattern:r,defValue:""}},e.prototype.isDMARC=function(e){return t.test(e)};var i=function(e,t,r){var a=[e];if(t.multi&&(a=e.split(t.multi).map(function(e){return e.trim()})),t.scrub&&(a=a.map(t.scrub)),r){var n;t.pattern?n=function(e){return t.pattern.test(e.toLowerCase())}:t.values&&(n=function(e){return t.values.indexOf(e.toLowerCase())>-1}),a=r(a,n)}var i=a.join(t.multi);return i};return e.prototype.isValid=function(e,t){var r;return i(t,this.validators[e],function(e,t){return r=e.every(t),e}),r},e.prototype.setValue=function(e,t,r){var a;r&&(a=function(e,t){return e.filter(t)});var n=i(t,this.validators[e],a);n.length?this[e]="number"==typeof this[e]?parseInt(n,10):n:"sp"===e?this.sp=this.p:this[e]=this.validators[e].defValue},e.prototype.fromTXT=function(e){if(this.resetProperties(),"string"==typeof e)for(var t=e.split(";"),r=0;r<t.length;r++){var a=t[r].split("="),n=a[0].trim().toLowerCase(),i=a.slice(1).join("=").trim();"v"!==n&&this.hasOwnProperty(n)&&this.setValue(n,i)}},e.prototype.toString=function(){var e="v=DMARC1;p="+this.p;return n(this.sp)&&(e+=";sp="+this.sp),n(this.adkim)&&(e+=";adkim="+this.adkim),n(this.aspf)&&(e+=";aspf="+this.aspf),n(this.pct)&&(e+=";pct="+this.pct),n(this.fo)&&(e+=";fo="+this.fo),n(this.rf)&&(e+=";rf="+this.rf),n(this.ri)&&(e+=";ri="+this.ri),n(this.rua)&&(this.setValue("rua",this.rua),e+=";rua="+this.rua),n(this.ruf)&&(this.setValue("ruf",this.ruf),e+=";ruf="+this.ruf),e},e}),define("app/directives/dmarc_validators",["angular","cjt/util/locale","cjt/validator/validator-utils","app/models/dmarc_record","cjt/validator/validateDirectiveFactory"],function(e,t,r,a){var n=new a,i={dmarcMailtoList:function(e,a){var i=r.initializeValidationResult();return i.isValid=n.isValid(a,e),i.isValid||i.add("dmarcMailtoList",t.maketext("The [asis,URI] list is invalid.")),i}},o=e.module("cjt2.validate");return o.run(["validatorFactory",function(e){e.generate(i)}]),{methods:i,name:"dmarcValidators",description:"Validation library for DMARC records.",version:2}}),define("app/directives/caa_validators",["angular","cjt/util/locale","cjt/validator/validator-utils","cjt/validator/domain-validators","cjt/validator/email-validator","cjt/validator/validateDirectiveFactory"],function(e,t,r,a,n){var i=/^mailto:/,o=function(e){var o,s=r.initializeValidationResult();return s.isValid=!1,i.test(e)?(e=e.replace(i,""),o=n.methods.email(e)):o=a.methods.url(e),s.isValid=o.isValid,s.isValid||s.add("caaIodef",t.maketext("You must enter a valid [asis,mailto] or standard [asis,URL].")),s},s=function(e){var n=r.initializeValidationResult();if(n.isValid=!1,";"===e)n.isValid=!0;else{var i=a.methods.zoneFqdn(e);n.isValid=i.isValid}return n.isValid||n.add("caaIssue",t.maketext("You must enter a valid zone name or a single semicolon.")),n},d={caaValue:function(e,t){return"iodef"===t?o(e):s(e)}},c=e.module("cjt2.validate");return c.run(["validatorFactory",function(e){e.generate(d)}]),{methods:d,name:"caaValidators",description:"Validation library for CAA records.",version:1}}),define("app/views/manage",["angular","lodash","cjt/util/locale","app/models/dynamic_table","app/models/dmarc_record","cjt/decorators/growlDecorator","cjt/directives/actionButtonDirective","cjt/decorators/paginationDecorator","cjt/directives/toggleSortDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective","cjt/directives/validationContainerDirective","cjt/directives/validationItemDirective","cjt/filters/qaSafeIDFilter","cjt/validator/ip-validators","cjt/validator/domain-validators","cjt/validator/compare-validators","cjt/validator/datatype-validators","cjt/services/viewNavigationApi","cjt/services/cpanel/nvDataService","cjt/directives/quickFiltersDirective","app/directives/convert_to_full_record_name","app/directives/dmarc_validators","app/directives/caa_validators","uiBootstrap"],function(e,t,r,a,n){var i=e.module("cpanel.zoneEditor"),o=i.controller("ManageZoneRecordsController",["$scope","$routeParams","growl","Zones","viewNavigationApi","$uibModal","Features","defaultInfo","nvDataService",function(e,i,o,s,d,c,l,u,m){function _(e,t){return-1!==e.name.indexOf(t)}function f(e,t){return e.type===t}function p(e,a){var n=this;n.record=a,n.cancel=function(){e.dismiss("cancel")},n.confirm=function(){return s.remove_zone_record(v.domain,a).then(function(){o.success("MX"===a.type&&a.name===v.domain+"."?r.maketext("You successfully deleted the [asis,_1] record.",a.type):r.maketext("You successfully deleted the [asis,_1] record: [_2]",a.type,t.escape(a.name))),v.refresh()}).catch(function(e){o.error(e)}).finally(function(){e.close()})}}function g(e){var t=this;t.cancel=function(){e.dismiss("cancel")},t.confirm=function(){return s.reset_zone(v.domain).then(function(){o.success(r.maketext("You successfully reset the zone for “[_1]”.",v.domain)),v.refresh()}).catch(function(e){o.error(e)}).finally(function(){e.close()})}}function h(e){return void 0===e&&(e=!1),v.is_loading=!0,s.fetch(v.domain,e).then(function(e){v.zone_records=[];for(var t=0,r=e.length;r>t;t++)"$TTL"!==e[t].type?l.simple&&!l.advanced&&"MX"!==e[t].type&&v.generated_domains[e[t].name]||(("A"===e[t].type||"CNAME"===e[t].type)&&v.Features.simple||"MX"===e[t].type&&v.Features.mx||"MX"!==e[t].type&&v.Features.advanced)&&v.zone_records.push(e[t]):v.default_ttl=e[t].ttl;A.loadData(v.zone_records),v.render(),v.new_record.ttl=v.default_ttl}).catch(function(e){v.loading_error=!0,v.loading_error_message=e}).finally(function(){v.is_loading=!1})}var v=this;v.is_loading=!1,v.zone_records=[],v.domain=i.domain,v.loading_error=!1,v.loading_error_message="",v.Features=l,v.generated_domains={};var w,y;v.adding_record=!1,v.editing_record=!1,v.save_in_progress=!1,v.record_being_edited=null,v.dmarc_optional_params_shown=!1,v.new_record={name:"",ttl:null,"class":"IN",type:"A",a_address:"",aaaa_address:"",address:"",cname:"",priority:null,weight:null,port:null,target:"",txtdata:"",exchanger:"",preference:null,line:null,flag:0,tag:"issue",value:"",_id:null},v.dmarc_record=new n,v.raw_dmarc_active=!1,v.editing_dmarc=!1,v.updateDMARCRecordFromTXT=function(){v.dmarc_record.fromTXT(v.new_record.txtdata),v.raw_dmarc_active=!1},v.updateTXTFromDMARCRecord=function(){v.new_record.txtdata=v.dmarc_record.toString(),v.raw_dmarc_active=!0},!l.mx||l.simple||l.advanced||(v.new_record.type="MX",v.new_record.name=v.domain+"."),v.resetNewRecord=function(){v.new_record.type="A",v.new_record.name="",v.new_record.ttl=v.default_ttl,v.new_record.class="IN",v.new_record.a_address="",v.new_record.aaaa_address="",v.new_record.address="",v.new_record.cname="",v.new_record.priority=null,v.new_record.weight=null,v.new_record.port=null,v.new_record.target="",v.new_record.txtdata="",v.new_record.exchanger="",v.new_record.preference=null,v.new_record.line=null,v.new_record.tag="issue",v.new_record.flag=0,v.new_record.value="",v.new_record._id=null,v.add_zr_form.$setPristine(!0),w=null,v.dmarc_record=new n,v.editing_dmarc=!1,v.dmarc_optional_params_shown=!1,!l.mx||l.simple||l.advanced||(v.new_record.type="MX",v.new_record.name=v.domain+".")};var A=new a;A.setFilterFunction(_),A.setQuickFilterFunction(f),A.meta.pageSize=u.zones_per_page,v.meta=A.getMetadata(),v.filteredList=A.getList(),v.paginationMessage=A.paginationMessage,v.render=function(){v.close_add_record(),v.filteredList=A.populate()},v.sortList=function(){v.render()},v.selectPage=function(){v.render()},v.selectPageSize=function(){v.render(),u.zones_per_page!==A.meta.pageSize&&m.setObject({zones_per_page:A.meta.pageSize}).then(function(){u.zones_per_page=A.meta.pageSize}).catch(function(e){o.error(e)})},v.searchList=function(){v.render()},v.dynamicPlaceholders={issue:r.maketext("Certificate Authority"),iodef:r.maketext("Mail Address for Notifications")},v.dynamicTooltips={issue:r.maketext("The certificate authority’s domain name."),iodef:r.maketext("The location to which the certificate authority will report exceptions. Either a [asis,mailto] or standard [asis,URL].")},v.valueTooltip=function(){return"iodef"===v.new_record.tag?v.dynamicTooltips.iodef:v.dynamicTooltips.issue},v.valuePlaceholder=function(){return"iodef"===v.new_record.tag?v.dynamicPlaceholders.iodef:v.dynamicPlaceholders.issue},p.$inject=["$uibModalInstance","record"],g.$inject=["$uibModalInstance"],v.open_add_record=function(e){v.adding_record||("undefined"!=typeof e&&(v.new_record.type=e,"DMARC"===v.new_record.type&&(v.new_record.name=s.format_zone_name(v.domain,"_dmarc."),v.new_record.txtdata=v.dmarc_record.toString(),v.new_record.type="TXT",v.editing_dmarc=!0,v.add_zr_form.$setDirty())),v.adding_record=!0)},v.restore_default_editor_position=function(){var e=document.getElementById("addRecordForm"),t=document.getElementById("loadingNotice");t.parentNode.insertBefore(e,t)},v.close_add_record=function(){v.editing_record&&v.new_record.line&&(v.record_being_edited=null),v.adding_record=!1,v.editing_record=!1,v.editing_dmarc=!1,v.restore_default_editor_position(),v.resetNewRecord()},v.save_edited_record=function(){v.save_in_progress=!0,"MX"===v.new_record.type&&(v.new_record.priority=v.new_record.preference);var e=v.build_update_candidate(!1);return s.update_record(v.domain,e).then(function(){if(o.success("MX"===v.new_record.type&&v.new_record.name===v.domain+"."?r.maketext("You successfully updated the [asis,_1] record for “[_2]”.",v.new_record.type,v.domain):r.maketext("You successfully updated the following [asis,_1] record for “[_2]”: [_3]",v.new_record.type,v.domain,t.escape(v.new_record.name))),null!==e.line){A.items[e._id]=t.extend(A.items[e._id],e);for(var a=0,n=v.filteredList.length;n>a;a++)if(v.filteredList[a].line===e.line){v.filteredList[a]=t.extend(v.filteredList[a],e);break}}v.resetNewRecord(),v.record_being_edited=null,v.restore_default_editor_position(),v.editing_record=!1,v.editing_dmarc=!1}).catch(function(e){o.error(e)}).finally(function(){v.save_in_progress=!1})},v.confirm_add_record=function(){v.save_in_progress=!0;var e=v.build_update_candidate(!0);return s.add_record(v.domain,e).then(function(){o.success("MX"===v.new_record.type&&v.new_record.name===v.domain+"."?r.maketext("You successfully added the [asis,_1] record for “[_2]”.",v.new_record.type,v.domain):r.maketext("You successfully added the following [asis,_1] record for “[_2]”: [_3]",v.new_record.type,v.domain,t.escape(v.new_record.name))),v.resetNewRecord(),v.adding_record=!1,v.refresh()}).catch(function(e){o.error(e)}).finally(function(){v.save_in_progress=!1})},v.field_has_error=function(e,t){return e&&t&&e[t].$invalid&&e[t].$dirty},e.$watch("manage.new_record.type",function(e,t){return t!==e?"MX"===e?(w=v.new_record.name,y=v.new_record.ttl,void(w||(v.new_record.name=v.domain+"."))):"MX"===t?(v.new_record.name=w,v.new_record.ttl=y,w=null,void(y=null)):void 0:void 0}),v.build_update_candidate=function(e){var t={};switch(t.name=v.new_record.name,t.type=v.new_record.type,t.class=v.new_record.class,t.ttl=v.new_record.ttl,e||(t.line=v.new_record.line,t._id=v.new_record._id),v.new_record.type){case"MX":t.exchange=v.new_record.exchanger,t.exchanger=v.new_record.exchanger,t.preference=v.new_record.preference,t.priority=v.new_record.preference;break;case"SRV":t.weight=v.new_record.weight,t.port=v.new_record.port,t.priority=v.new_record.priority,t.target=v.new_record.target;break;case"CAA":t.tag=v.new_record.tag,t.flag=v.new_record.flag,t.value=v.new_record.value;break;case"CNAME":t.cname=v.new_record.cname,t.record=v.new_record.cname;break;case"TXT":v.editing_dmarc&&!v.raw_dmarc_active&&(v.new_record.txtdata=v.dmarc_record.toString()),t.txtdata=v.new_record.txtdata,t.record=v.new_record.txtdata;break;case"A":t.address=v.new_record.a_address,t.record=v.new_record.a_address;break;case"AAAA":t.address=v.new_record.aaaa_address,t.record=v.new_record.aaaa_address}return t},v.edit_record=function(e){switch(v.adding_record=!1,v.new_record.name=e.name,v.new_record.type=e.type,v.new_record.class=e.class,v.new_record.ttl=e.ttl,v.new_record.line=e.line,v.new_record._id=e._id,e.type){case"MX":v.new_record.exchanger=e.exchange,v.new_record.preference=e.preference;break;case"SRV":v.new_record.weight=e.weight,v.new_record.port=e.port,v.new_record.priority=e.priority,v.new_record.target=e.target;break;case"CAA":v.new_record.tag=e.tag,v.new_record.flag=e.flag,v.new_record.value=e.value;break;case"CNAME":v.new_record.cname=e.cname;break;case"TXT":v.new_record.txtdata=e.txtdata,(v.editing_dmarc||v.dmarc_record.isDMARC(v.new_record.txtdata))&&(v.dmarc_record.fromTXT(v.new_record.txtdata),v.editing_dmarc=!0,v.add_zr_form.$setDirty());
break;case"A":v.new_record.a_address=e.address;break;case"AAAA":v.new_record.aaaa_address=e.address}var t=document.getElementById("addRecordForm"),r=document.getElementById("zone_rec_row_"+e.line);r.parentNode.insertBefore(t,r),v.record_being_edited=e.line,v.editing_record=!0},v.confirm_delete_record=function(e){v.close_add_record(),c.open({templateUrl:"confirm_delete.html",controller:p,controllerAs:"ctrl",resolve:{record:function(){return e}}})},v.confirm_reset_zone=function(){v.editing_record||v.adding_record||c.open({templateUrl:"confirm_reset_zone.html",controller:g,controllerAs:"ctrl"})},v.refresh=function(){return v.editing_record||v.adding_record?void 0:h(!0)},v.goToView=function(e){d.loadView(e)},v.init=function(){return v.is_loading=!0,s.fetch_generated_domains(v.domain,!0).then(function(e){return v.generated_domains=e,h(!0)}).catch(function(e){v.loading_error=!0,v.loading_error_message=e})},v.init()}]);return o}),define("app/views/dnssec",["angular","cjt/util/locale","cjt/util/parse","cjt/decorators/growlDecorator","cjt/directives/toggleSwitchDirective","cjt/directives/actionButtonDirective","cjt/services/viewNavigationApi","uiBootstrap"],function(e,t,r){var a=e.module("cpanel.zoneEditor"),n=a.controller("DnsSecController",["$scope","$q","$routeParams","growl","viewNavigationApi","DNSSEC","Features",function(e,a,n,i,o,s,d){function c(e){for(var a=0,n=e.length;n>a;a++){var i=e[a];i.active=r.parsePerlBoolean(i.active);for(var o=0,s=i.digests.length;s>o;o++){var d=i.digests[o];"2"===d.algo_num&&(i.selected_digest=d)}i.bits_msg=t.maketext("[quant,_1,bit,bits]",i.bits),i.hasOwnProperty("selected_digest")||(i.selected_digest=i.digests[0])}}var l=this;l.domain=n.domain,l.is_loading=!1,l.loading_error=!1,l.loading_error_message="",l.enabled=!1,l.keys=[],l.goToView=function(e){o.loadView(e)},l.toggle_status=function(){return l.enabled?void(l.show_disable_warning=!0):s.enable(l.domain).then(function(){return s.fetch(l.domain).then(function(e){e.length?(l.enabled=!0,l.keys=e,c(l.keys)):l.enabled=!1}).catch(function(e){i.error(e)})}).catch(function(e){i.error(e)})},l.confirm_disable=function(){return s.disable(l.domain).then(function(){l.enabled=!1}).catch(function(e){i.error(e)}).finally(function(){l.show_disable_warning=!1})},l.cancel_disable=function(){l.show_disable_warning=!1},l.load=function(){return l.is_loading=!0,s.fetch(l.domain).then(function(e){e.length?(l.enabled=!0,l.keys=e,c(l.keys)):l.enabled=!1}).catch(function(e){i.error(e)}).finally(function(){l.is_loading=!1})},l.init=function(){d.dnssec?l.load():(l.loading_error=!0,l.loading_error_message=t.maketext("This feature is not available to your account."))},l.init()}]);return n}),define("app/index",["angular","jquery","lodash","cjt/core","cjt/modules","ngRoute","uiBootstrap"],function(e){"use strict";return function(){e.module("cpanel.zoneEditor",["ngRoute","ui.bootstrap","angular-growl","cjt2.cpanel"]);var t=require(["cjt/bootstrap","app/services/page_data_service","app/services/domains","app/services/zones","app/services/dnssec","app/services/features","app/models/dynamic_table","app/directives/convert_to_full_record_name","app/views/domain_selection","app/views/manage","app/views/dnssec","app/models/dmarc_record"],function(t){var r=e.module("cpanel.zoneEditor");r.factory("defaultInfo",["pageDataService",function(e){return e.prepareDefaultInfo(PAGE)}]),r.config(["$routeProvider",function(e){e.when("/list",{controller:"ListDomainsController",controllerAs:"list",templateUrl:"zone_editor/views/domain_selection.ptt"}),e.when("/manage/:domain",{controller:"ManageZoneRecordsController",controllerAs:"manage",templateUrl:"zone_editor/views/manage.ptt"}),e.when("/dnssec/:domain",{controller:"DnsSecController",controllerAs:"dnssec",templateUrl:"zone_editor/views/dnssec.ptt"}),e.otherwise({redirectTo:"/list"})}]),t("#content","cpanel.zoneEditor")});return t}});