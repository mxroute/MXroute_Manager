define(["angular","cjt/util/locale","cjt/util/parse","cjt/directives/toggleSwitchDirective","cjt/directives/actionButtonDirective","cjt/directives/alertList","cjt/services/alertService","cjt/services/viewNavigationApi","uiBootstrap"],function(angular,LOCALE,PARSE){var app=angular.module("cpanel.zoneEditor");var controller=app.controller("DnsSecController",["$scope","$q","$routeParams","viewNavigationApi","DNSSEC","Features","alertService",function($scope,$q,$routeParams,viewNavigationApi,DNSSEC,Features,alertService){var dnssec=this;dnssec.domain=$routeParams.domain;dnssec.is_loading=false;dnssec.loading_error=false;dnssec.loading_error_message="";dnssec.enabled=false;dnssec.keys=[];dnssec.goToView=function(view){viewNavigationApi.loadView(view)};function parseDnssecKeys(dnssecKeys){for(var i=0,len=dnssecKeys.length;i<len;i++){var key=dnssecKeys[i];key.active=PARSE.parsePerlBoolean(key.active);for(var j=0,digestLen=key.digests.length;j<digestLen;j++){var item=key.digests[j];if(item.algo_num==="2"){key.selected_digest=item}}key.bits_msg=LOCALE.maketext("[quant,_1,bit,bits]",key.bits);if(!key.hasOwnProperty("selected_digest")){key.selected_digest=key.digests[0]}}}dnssec.toggle_status=function(){if(dnssec.enabled){dnssec.show_disable_warning=true;return}return DNSSEC.enable(dnssec.domain).then(function(result){return DNSSEC.fetch(dnssec.domain).then(function(result){if(result.length){dnssec.enabled=true;dnssec.keys=result;parseDnssecKeys(dnssec.keys)}else{dnssec.enabled=false}}).catch(function(error){alertService.add({type:"danger",message:error,closeable:true,replace:false,group:"zoneEditor"})})}).catch(function(error){alertService.add({type:"danger",message:error,closeable:true,replace:false,group:"zoneEditor"})})};dnssec.confirm_disable=function(){return DNSSEC.disable(dnssec.domain).then(function(result){dnssec.enabled=false}).catch(function(error){alertService.add({type:"danger",message:error,closeable:true,replace:false,group:"zoneEditor"})}).finally(function(){dnssec.show_disable_warning=false})};dnssec.cancel_disable=function(){dnssec.show_disable_warning=false};dnssec.load=function(){dnssec.is_loading=true;return DNSSEC.fetch(dnssec.domain).then(function(result){if(result.length){dnssec.enabled=true;dnssec.keys=result;parseDnssecKeys(dnssec.keys)}else{dnssec.enabled=false}}).catch(function(error){alertService.add({type:"danger",message:error,closeable:true,replace:false,group:"zoneEditor"})}).finally(function(){dnssec.is_loading=false})};dnssec.init=function(){if(Features.dnssec){dnssec.load()}else{dnssec.loading_error=true;dnssec.loading_error_message=LOCALE.maketext("This feature is not available to your account.")}};dnssec.init()}]);return controller});