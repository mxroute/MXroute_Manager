define(["angular","lodash","app/services/applicationListService","app/directives/draggableDirective","app/directives/dropDirective","app/directives/applicationListFilterDirective"],function(angular,_){var app=angular.module("App");var controller=app.controller("applicationListController",["$scope","applicationListService",function($scope,applicationListService){var applicationList=PAGE.appGroups;var collapsedGroupsList=PAGE.collapsedGroups.split("|");$scope.collapsedGroups=PAGE.collapsedGroups;var searchBox=document.querySelector("#quickjump");if(searchBox&&$scope.searchText!==searchBox.value){$scope.searchText=searchBox.value}$scope.clearSearch=function(event){if(event.keyCode===27){$scope.searchText=""}};var searchCache={};$scope.searchGroup=function(group){if(!$scope.searchText){return 1}if(!searchCache[$scope.searchText]){searchCache[$scope.searchText]=new RegExp($scope.searchText,"i")}var regex=searchCache[$scope.searchText];var found=false;var groupInfo=_.find(applicationList,function(app){return app.group===group});var items=groupInfo.length?groupInfo.items:[];for(var i=0,len=items.length;i<len;i++){found=regex.test(items[i].searchtext);if(found){return found}}};$scope.searchItem=function(item){if(!$scope.searchText){return 1}if(!searchCache[$scope.searchText]){searchCache[$scope.searchText]=new RegExp($scope.searchText,"i")}var regex=searchCache[$scope.searchText];return regex.test(item.searchtext)};$scope.toggleGroup=function(group){var groupBody=angular.element(document.querySelector("#"+group+"-body"));var groupCollapseIndicator=angular.element(document.querySelector("#"+group+"-collapsed-indicator"));group=group+"=0";var index=collapsedGroupsList.indexOf(group);if(index===-1){groupBody.removeClass("maximize");collapsedGroupsList.push(group);groupBody.addClass("minimized ng-hide");groupCollapseIndicator.removeClass("fa-minus");groupCollapseIndicator.addClass("fa-plus")}else{groupBody.removeClass("minimized ng-hide");collapsedGroupsList.splice(index,1);groupBody.addClass("maximize");groupCollapseIndicator.removeClass("fa-plus");groupCollapseIndicator.addClass("fa-minus")}var groupList=collapsedGroupsList.join("|");$scope.collapsedGroups=groupList;applicationListService.setCollapsedGroupsList(groupList)};$scope.handleDrag=function(itemID){var groupName=itemID.replace("-group",""),groupBody=angular.element(document.querySelector("#"+groupName+"-body"));groupBody.removeClass("minimize maximize");var startingPosition=_.findIndex(applicationList,function(group){return group.group===groupName});var previousDropAreaId="#top-drop-area";if(startingPosition>0){previousDropAreaId="#"+applicationList[startingPosition-1].group+"-drop-area"}var hiddenDropArea=angular.element(document.querySelector(previousDropAreaId));hiddenDropArea.addClass("drag-hidden")};$scope.handleDragEnd=function(){var hiddenDropArea=angular.element(document.querySelectorAll(".drag-hidden"));hiddenDropArea.removeClass("drag-hidden")};$scope.handleDrop=function(item,dropArea){var groupToMove=item.getAttribute("data-group-name");var moveAfter=dropArea.getAttribute("data-group-name");var boxes=document.querySelector("#boxes");var groupToMoveContainer,moveAfterContainer;if(moveAfter){groupToMoveContainer=document.querySelector("#"+groupToMove+"-container");moveAfterContainer=document.querySelector("#"+moveAfter+"-container")}else{groupToMoveContainer=document.querySelector("#"+groupToMove+"-container");moveAfterContainer=document.querySelector("#top-drop-area")}if(boxes&&groupToMoveContainer&&moveAfterContainer){boxes.insertBefore(groupToMoveContainer,moveAfterContainer.nextSibling)}var oldPosition=_.findIndex(applicationList,function(group){return group.group===item.id.replace("-group","")});var movedGroup=applicationList[oldPosition];var newPosition=_.findIndex(applicationList,function(group){return group.group===dropArea.id.replace("-drop-area","")});if(oldPosition>newPosition){newPosition+=1}applicationList.splice(oldPosition,1);applicationList.splice(newPosition,0,movedGroup);var newOrder=_.map(applicationList,"group").join("|");applicationListService.setGroupsOrder(newOrder)}}]);return controller});